import{aP as pt,r as P,c as O,aX as st,x as i,y as a,z as t,O as k,L as T,P as l,u as e,C as j,K as nt,aq as dt,aa as gt,f as xt,Y as vt,Q as G,ac as tt,B as lt,R as Q,o as ut,V as yt,I as ot,a5 as bt,q as kt,aW as _t,J as ft,av as ht}from"./vue-vendor-R8HMg95E.js";import{_ as et,A as wt,a as $t}from"./index-BI6tb3au.js";import{L as Ct}from"./LogoTitle-azhgMsby.js";import{T as St}from"./ThemeToggle-DXiFLaN3.js";import{b as Kt}from"./vendor-Dr8jvgFu.js";import{_ as At}from"./WindowCountdown-DF7xS2EZ.js";import Tt from"./TutorialView-TiXtx2xS.js";import"./element-plus-BUfCkBQO.js";class Lt{constructor(){this.baseURL=window.location.origin,this.isDev=!1}async request(p,s={}){try{this.isDev&&p.startsWith("/admin")&&(p="/webapi"+p);const f=await fetch(`${this.baseURL}${p}`,{headers:{"Content-Type":"application/json",...s.headers},...s}),o=await f.json();if(!f.ok){const m=new Error(o.message||`请求失败: ${f.status}`);throw m.data=o,m.status=f.status,m}return o}catch(f){throw console.error("API Stats request error:",f),f}}async getKeyId(p){return this.request("/apiStats/api/get-key-id",{method:"POST",body:JSON.stringify({apiKey:p})})}async getUserStats(p){return this.request("/apiStats/api/user-stats",{method:"POST",body:JSON.stringify({apiId:p})})}async getUserModelStats(p,s="daily"){return this.request("/apiStats/api/user-model-stats",{method:"POST",body:JSON.stringify({apiId:p,period:s})})}async getOemSettings(){try{return await this.request("/admin/oem-settings")}catch(p){return console.error("Failed to load OEM settings:",p),{success:!0,data:{siteName:"Claude Relay Service",siteIcon:"",siteIconData:""}}}}async getBatchStats(p){return this.request("/apiStats/api/batch-stats",{method:"POST",body:JSON.stringify({apiIds:p})})}async getBatchModelStats(p,s="daily"){return this.request("/apiStats/api/batch-model-stats",{method:"POST",body:JSON.stringify({apiIds:p,period:s})})}async mergeKeys(p){return this.request("/apiStats/api/merge-keys",{method:"POST",body:JSON.stringify(p)})}}const X=new Lt,at=pt("apistats",()=>{const V=P(""),p=P(null),s=P(!1),f=P(!1),o=P(!0),m=P(""),u=P("daily"),b=P(null),_=P([]),M=P(null),v=P(null),A=P({siteName:"",siteIcon:"",siteIconData:""}),F=P(!1),$=P([]),h=P([]),c=P(null),n=P([]),D=P([]),x=O(()=>{const g={requests:0,inputTokens:0,outputTokens:0,cacheCreateTokens:0,cacheReadTokens:0,allTokens:0,cost:0,formattedCost:"$0.000000"};return F.value&&c.value?u.value==="daily"?c.value.dailyUsage||g:c.value.monthlyUsage||g:u.value==="daily"?M.value||g:v.value||g}),C=O(()=>{if(!b.value||!x.value)return{tokenUsage:0,costUsage:0,requestUsage:0};const g=x.value,w=b.value.limits;return{tokenUsage:w.tokenLimit>0?Math.min(g.allTokens/w.tokenLimit*100,100):0,costUsage:w.dailyCostLimit>0?Math.min(g.cost/w.dailyCostLimit*100,100):0,requestUsage:w.rateLimitRequests>0?Math.min(g.requests/w.rateLimitRequests*100,100):0}});async function q(){if(F.value)return Y();const g=V.value.trim();if(!g){m.value="请输入 API Key";return}if(g.length<10||g.length>512){m.value="API Key 格式无效：长度应在 10-512 个字符之间";return}s.value=!0,m.value="",b.value=null,_.value=[],p.value=null;try{const w=await X.getKeyId(g);if(w.success){p.value=w.data.id;const U=await X.getUserStats(p.value);if(U.success)b.value=U.data,await L(),m.value="",J();else throw new Error(U.message||"查询失败")}else throw new Error(w.message||"获取 API Key ID 失败")}catch(w){console.error("Query stats error:",w),m.value=w.message||"查询统计数据失败，请检查您的 API Key 是否正确",b.value=null,_.value=[],p.value=null}finally{s.value=!1}}async function L(){p.value&&(await Promise.all([N("daily"),N("monthly")]),await R(u.value))}async function N(g){try{const w=await X.getUserModelStats(p.value,g);if(w.success){const U=w.data||[],z={requests:0,inputTokens:0,outputTokens:0,cacheCreateTokens:0,cacheReadTokens:0,allTokens:0,cost:0,formattedCost:"$0.000000"};U.forEach(E=>{var H;z.requests+=E.requests||0,z.inputTokens+=E.inputTokens||0,z.outputTokens+=E.outputTokens||0,z.cacheCreateTokens+=E.cacheCreateTokens||0,z.cacheReadTokens+=E.cacheReadTokens||0,z.allTokens+=E.allTokens||0,z.cost+=((H=E.costs)==null?void 0:H.total)||0}),z.formattedCost=Z(z.cost),g==="daily"?M.value=z:v.value=z}else console.warn(`Failed to load ${g} stats:`,w.message)}catch(w){console.error(`Load ${g} stats error:`,w)}}async function R(g="daily"){if(p.value){f.value=!0;try{const w=await X.getUserModelStats(p.value,g);if(w.success)_.value=w.data||[];else throw new Error(w.message||"加载模型统计失败")}catch(w){console.error("Load model stats error:",w),_.value=[]}finally{f.value=!1}}}async function K(g){if(!(u.value===g||f.value)){if(u.value=g,F.value&&h.value.length>0){await rt(g);return}(g==="daily"&&!M.value||g==="monthly"&&!v.value)&&await N(g),await R(g)}}async function W(){var g,w;if(p.value){s.value=!0,m.value="",b.value=null,_.value=[];try{const U=await X.getUserStats(p.value);if(U.success)b.value=U.data,console.log("API Stats - Full response:",U.data),console.log("API Stats - limits data:",U.data.limits),console.log("API Stats - weeklyOpusCostLimit:",(g=U.data.limits)==null?void 0:g.weeklyOpusCostLimit),console.log("API Stats - weeklyOpusCost:",(w=U.data.limits)==null?void 0:w.weeklyOpusCost),await L(),m.value="";else throw new Error(U.message||"查询失败")}catch(U){console.error("Load stats with apiId error:",U),m.value=U.message||"查询统计数据失败",b.value=null,_.value=[]}finally{s.value=!1}}}async function S(){o.value=!0;try{const g=await X.getOemSettings();g&&g.success&&g.data&&(A.value={...A.value,...g.data})}catch(g){console.error("Error loading OEM settings:",g),A.value={siteName:"Claude Relay Service",siteIcon:"",siteIconData:""}}finally{o.value=!1}}function Z(g){return typeof g!="number"||g===0?"$0.000000":g>=1?"$"+g.toFixed(2):g>=.01?"$"+g.toFixed(4):"$"+g.toFixed(6)}function J(){if(p.value){const g=new URL(window.location);g.searchParams.set("apiId",p.value),window.history.pushState({},"",g)}}async function Y(){const g=d();if(g.length===0){m.value="请输入至少一个有效的 API Key";return}s.value=!0,m.value="",c.value=null,n.value=[],D.value=[],_.value=[],$.value=g,h.value=[];try{const w=await Promise.allSettled(g.map(H=>X.getKeyId(H))),U=[],z=[];if(w.forEach((H,it)=>{H.status==="fulfilled"&&H.value.success?(U.push(H.value.data.id),z.push(g[it])):D.value.push(g[it])}),U.length===0)throw new Error("所有 API Key 都无效");h.value=U,$.value=z;const E=await X.getBatchStats(U);if(E.success)c.value=E.data.aggregated,n.value=E.data.individual,b.value=E.data.aggregated,M.value=E.data.aggregated.dailyUsage||null,v.value=E.data.aggregated.monthlyUsage||null,await rt(u.value),r();else throw new Error(E.message||"批量查询失败")}catch(w){console.error("Batch query error:",w),m.value=w.message||"批量查询统计数据失败",c.value=null,n.value=[]}finally{s.value=!1}}async function rt(g="daily"){if(h.value.length!==0){f.value=!0;try{const w=await X.getBatchModelStats(h.value,g);if(w.success)_.value=w.data||[];else throw new Error(w.message||"加载批量模型统计失败")}catch(w){console.error("Load batch model stats error:",w),_.value=[]}finally{f.value=!1}}}function d(){if(!V.value)return[];const g=V.value.split(/[,\n]+/).map(U=>U.trim()).filter(U=>U.length>=10&&U.length<=512);return[...new Set(g)].slice(0,30)}function r(){if(h.value.length>0){const g=new URL(window.location);g.searchParams.set("apiIds",h.value.join(",")),g.searchParams.set("batch","true"),window.history.pushState({},"",g)}}function y(){V.value=""}function I(){b.value=null,_.value=[],M.value=null,v.value=null,m.value="",u.value="daily",p.value=null,$.value=[],h.value=[],c.value=null,n.value=[],D.value=[]}function B(){V.value="",F.value=!1,I()}return{apiKey:V,apiId:p,loading:s,modelStatsLoading:f,oemLoading:o,error:m,statsPeriod:u,statsData:b,modelStats:_,dailyStats:M,monthlyStats:v,oemSettings:A,multiKeyMode:F,apiKeys:$,apiIds:h,aggregatedStats:c,individualStats:n,invalidKeys:D,currentPeriodData:x,usagePercentages:C,queryStats:q,queryBatchStats:Y,loadAllPeriodStats:L,loadPeriodStats:N,loadModelStats:R,loadBatchModelStats:rt,switchPeriod:K,loadStatsWithApiId:W,loadOemSettings:S,clearData:I,clearInput:y,reset:B}}),It={class:"api-input-wide-card mb-8 rounded-3xl p-6 shadow-xl"},Pt={class:"mx-auto max-w-4xl"},Mt={class:"control-bar mb-4 flex flex-wrap items-center justify-between gap-3"},Dt={class:"text-sm font-medium text-gray-700 dark:text-gray-300"},qt={class:"button-group flex items-center gap-2"},jt={class:"mode-switch-group flex items-center rounded-lg bg-gray-100 p-1 dark:bg-gray-800"},Ut={key:0,class:"ml-1 rounded-full bg-white/20 px-1.5 py-0.5 text-xs font-semibold"},Rt={class:"api-input-grid grid grid-cols-1 gap-4 lg:grid-cols-4"},Ot={class:"lg:col-span-3"},Nt=["disabled"],Et={key:1,class:"relative"},Ft=["disabled"],Vt={class:"lg:col-span-1"},Wt=["disabled"],Bt={key:0,class:"fas fa-spinner loading-spinner"},zt={key:1,class:"fas fa-search"},Jt={class:"security-notice mt-4"},Yt={key:0,class:"mt-2 rounded-lg bg-blue-50 p-3 text-sm text-blue-700 dark:bg-blue-900/20 dark:text-blue-400"},Ht={__name:"ApiKeyInput",setup(V){const p=at(),{apiKey:s,loading:f,multiKeyMode:o}=st(p),{queryStats:m,clearInput:u}=p,b=O(()=>{if(!o.value||!s.value)return[];const M=s.value.split(/[,\n]+/).map(A=>A.trim()).filter(A=>A.length>0);return[...new Set(M)].slice(0,30)}),_=O(()=>o.value?b.value.length>0:s.value&&s.value.trim().length>0);return(M,v)=>(a(),i("div",It,[v[15]||(v[15]=t("div",{class:"wide-card-title mb-6"},[t("h2",{class:"mb-2 text-2xl font-bold text-gray-900 dark:text-gray-200"},[t("i",{class:"fas fa-chart-line mr-3"}),k(" 使用统计查询 ")]),t("p",{class:"text-base text-gray-600 dark:text-gray-400"},"查询您的 API Key 使用情况和统计数据")],-1)),t("div",Pt,[t("div",Mt,[t("label",Dt,[v[8]||(v[8]=t("i",{class:"fas fa-key mr-2"},null,-1)),k(" "+l(e(o)?"输入您的 API Keys（每行一个或用逗号分隔）":"输入您的 API Key"),1)]),t("div",qt,[t("div",jt,[t("button",{class:j(["mode-switch-btn",{active:!e(o)}]),title:"单一模式",onClick:v[0]||(v[0]=A=>o.value=!1)},v[9]||(v[9]=[t("i",{class:"fas fa-key"},null,-1),t("span",{class:"ml-2 hidden sm:inline"},"单一",-1)]),2),t("button",{class:j(["mode-switch-btn",{active:e(o)}]),title:"聚合模式",onClick:v[1]||(v[1]=A=>o.value=!0)},[v[10]||(v[10]=t("i",{class:"fas fa-layer-group"},null,-1)),v[11]||(v[11]=t("span",{class:"ml-2 hidden sm:inline"},"聚合",-1)),e(o)&&b.value.length>0?(a(),i("span",Ut,l(b.value.length),1)):T("",!0)],2)])])]),t("div",Rt,[t("div",Ot,[e(o)?(a(),i("div",Et,[nt(t("textarea",{"onUpdate:modelValue":v[4]||(v[4]=A=>xt(s)?s.value=A:null),class:"wide-card-input w-full resize-y",disabled:e(f),placeholder:`请输入您的 API Keys，支持以下格式：
cr_xxx
cr_yyy
或
cr_xxx, cr_yyy`,rows:"4",onKeyup:v[5]||(v[5]=gt(vt((...A)=>e(m)&&e(m)(...A),["ctrl"]),["enter"]))},null,40,Ft),[[dt,e(s)]]),e(s)&&!e(f)?(a(),i("button",{key:0,class:"absolute right-2 top-2 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300",title:"清空输入",onClick:v[6]||(v[6]=(...A)=>e(u)&&e(u)(...A))},v[12]||(v[12]=[t("i",{class:"fas fa-times-circle"},null,-1)]))):T("",!0)])):nt((a(),i("input",{key:0,"onUpdate:modelValue":v[2]||(v[2]=A=>xt(s)?s.value=A:null),class:"wide-card-input w-full",disabled:e(f),placeholder:"请输入您的 API Key (cr_...)",type:"password",onKeyup:v[3]||(v[3]=gt((...A)=>e(m)&&e(m)(...A),["enter"]))},null,40,Nt)),[[dt,e(s)]])]),t("div",Vt,[t("button",{class:"btn btn-primary btn-query flex h-full w-full items-center justify-center gap-2",disabled:e(f)||!_.value,onClick:v[7]||(v[7]=(...A)=>e(m)&&e(m)(...A))},[e(f)?(a(),i("i",Bt)):(a(),i("i",zt)),k(" "+l(e(f)?"查询中...":"查询统计"),1)],8,Wt)])]),t("div",Jt,[v[13]||(v[13]=t("i",{class:"fas fa-shield-alt mr-2"},null,-1)),k(" "+l(e(o)?"您的 API Keys 仅用于查询统计数据，不会被存储。聚合模式下部分个体化信息将不显示。":"您的 API Key 仅用于查询自己的统计数据，不会被存储或用于其他用途"),1)]),e(o)?(a(),i("div",Yt,v[14]||(v[14]=[t("i",{class:"fas fa-lightbulb mr-2"},null,-1),t("span",null,"提示：最多支持同时查询 30 个 API Keys。使用 Ctrl+Enter 快速查询。",-1)]))):T("",!0)])]))}},Gt=et(Ht,[["__scopeId","data-v-11e74200"]]),Qt={class:"space-y-6 md:space-y-8"},Xt={class:"grid grid-cols-1 items-stretch gap-4 md:gap-6 xl:grid-cols-[minmax(0,1.5fr)_minmax(0,1fr)]"},Zt={class:"card-section"},te={class:"section-header"},ee={class:"header-title"},se={key:0,class:"info-grid"},ae={class:"info-item"},re={class:"info-value"},le={class:"info-item"},ie={class:"info-value text-green-600 dark:text-emerald-400"},oe={key:0,class:"info-item"},ne={class:"info-value text-red-500 dark:text-red-400"},de={class:"info-item"},ue={class:"info-value"},ce={class:"info-item"},me={class:"info-value"},ge={class:"info-item"},xe={class:"info-value text-indigo-600 dark:text-indigo-300"},fe={key:1,class:"info-item xl:col-span-2"},ye={class:"space-y-2"},pe={class:"truncate"},ve={class:"font-semibold"},be={key:1,class:"info-grid"},ke={class:"info-item"},_e={class:"info-value break-all"},he={class:"info-item"},we={class:"info-item"},$e={class:"info-value"},Ce={class:"info-item"},Se={class:"info-value break-all"},Ke={class:"info-item xl:col-span-2"},Ae={class:"info-value"},Te={class:"ml-2 text-xs text-gray-500 dark:text-gray-400"},Le={key:0,class:"text-red-500 dark:text-red-400"},Ie={key:1,class:"text-orange-500 dark:text-orange-400"},Pe={key:2},Me={key:2,class:"text-gray-400 dark:text-gray-500"},De={class:"card-section"},qe={class:"section-header"},je={class:"header-tag"},Ue={class:"metric-grid"},Re={class:"metric-card"},Oe={class:"metric-value text-green-600 dark:text-emerald-300"},Ne={class:"metric-label"},Ee={class:"metric-card"},Fe={class:"metric-value text-blue-600 dark:text-sky-300"},Ve={class:"metric-label"},We={class:"metric-card"},Be={class:"metric-value text-purple-600 dark:text-violet-300"},ze={class:"metric-label"},Je={class:"metric-card"},Ye={class:"metric-value text-amber-500 dark:text-amber-300"},He={class:"metric-label"},Ge={key:0,class:"card-section"},Qe={class:"flex items-center justify-between gap-3"},Xe={class:"flex items-center gap-3"},Ze={class:"account-name"},ts={class:"account-sub"},es={key:0,class:"mt-3 space-y-2"},ss={class:"progress-row"},as={class:"progress-track"},rs={class:"progress-value"},ls={class:"flex flex-wrap items-center gap-2 text-xs text-gray-600 dark:text-gray-300"},is={key:0,class:"font-medium text-indigo-600 dark:text-indigo-400"},os={key:1,class:"mt-3"},ns={key:0,class:"space-y-2"},ds={class:"quota-header"},us={class:"quota-percent"},cs={class:"progress-track"},ms={class:"quota-foot"},gs={key:1,class:"rounded-xl bg-slate-100 px-3 py-2 text-xs text-slate-500 dark:bg-slate-800 dark:text-slate-300"},xs={__name:"StatsOverview",setup(V){const p=at(),{statsData:s,statsPeriod:f,currentPeriodData:o,multiKeyMode:m,aggregatedStats:u,individualStats:b,invalidKeys:_}=st(p),M=O(()=>!b.value||b.value.length===0?[]:[...b.value].sort((d,r)=>{var y,I;return(((y=r.usage)==null?void 0:y.allTokens)||0)-(((I=d.usage)==null?void 0:I.allTokens)||0)}).slice(0,3)),v=d=>{var y;return!u.value||!u.value.usage.allTokens?0:((((y=d.usage)==null?void 0:y.allTokens)||0)/u.value.usage.allTokens*100).toFixed(1)},A=d=>{if(!d)return"无";try{return Kt(d).format("YYYY年MM月DD日 HH:mm")}catch{return"格式错误"}},F=d=>d?new Date(d).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",$=d=>d?new Date(d)<new Date:!1,h=d=>{if(!d)return!1;const I=(new Date(d)-new Date)/(1e3*60*60*24);return I>0&&I<=7},c=d=>(typeof d!="number"&&(d=parseInt(d)||0),d===0?"0":d>=1e6?(d/1e6).toFixed(1)+"M":d>=1e3?(d/1e3).toFixed(1)+"K":d.toLocaleString()),n=d=>({claude:"Claude",gemini:"Gemini",all:"全部模型"})[d]||d||"未知",D=O(()=>{var y,I;const d=(I=(y=s.value)==null?void 0:y.accounts)==null?void 0:I.details;if(!d)return[];const r=[];return d.claude&&d.claude.accountType==="dedicated"&&r.push({key:"claude",...d.claude}),d.openai&&d.openai.accountType==="dedicated"&&r.push({key:"openai",...d.openai}),r}),x=O(()=>{const d=D.value.length;return d<=1?"md:grid-cols-1 lg:grid-cols-1":d===2?"md:grid-cols-2":"md:grid-cols-2 xl:grid-cols-3"}),C=d=>d?d.platform==="openai"?"OpenAI 专属账号":"Claude 专属账号":"专属账号",q=d=>{if(!d||d<=0)return"";const r=Math.floor(d),y=Math.floor(r/1440),I=Math.floor(r%1440/60),B=r%60;return y>0?I>0?`${y}天${I}小时`:`${y}天`:I>0?B>0?`${I}小时${B}分钟`:`${I}小时`:`${B}分钟`},L=d=>{if(!d)return{text:"状态未知",class:"text-gray-400"};if(d.isRateLimited){const r=q(d.minutesRemaining);return{text:`限流中${r?` · 剩余约 ${r}`:""}`,class:"text-red-500 dark:text-red-400"}}return{text:"未限流",class:"text-green-600 dark:text-emerald-400"}},N=(d,r)=>{if(!d||!r)return"暂无时间窗口信息";const y=new Date(d),I=new Date(r),B=g=>`${`${g.getHours()}`.padStart(2,"0")}:${`${g.getMinutes()}`.padStart(2,"0")}`;return`${B(y)} - ${B(I)}`},R=d=>{if(!d||d<=0)return"";const r=Math.floor(d/60),y=d%60;return r>0?`${r}小时${y}分钟`:`${y}分钟`},K=(d,r)=>{var I;if(!d)return"bg-gradient-to-r from-blue-500 to-indigo-500";if((I=r==null?void 0:r.rateLimitStatus)!=null&&I.isRateLimited)return"bg-gradient-to-r from-red-500 to-red-600";const y=String(d).toLowerCase();return y==="rejected"?"bg-gradient-to-r from-red-500 to-red-600":y==="allowed_warning"?"bg-gradient-to-r from-yellow-500 to-orange-500":"bg-gradient-to-r from-blue-500 to-indigo-500"},W=d=>{if(!d)return null;const r=typeof d.usedPercent=="number"&&!Number.isNaN(d.usedPercent)?d.usedPercent:null,y=typeof d.resetAfterSeconds=="number"&&!Number.isNaN(d.resetAfterSeconds)?d.resetAfterSeconds:null,I=typeof d.remainingSeconds=="number"?d.remainingSeconds:null,B=d.resetAt?Date.parse(d.resetAt):null;return y!==null&&(I!==null&&I<=0||B!==null&&!Number.isNaN(B)&&Date.now()>=B)?0:r===null?null:Math.max(0,Math.min(100,r))},S=d=>{const r=W(d);return r===null?"bg-gradient-to-r from-gray-300 to-gray-400":r>=90?"bg-gradient-to-r from-red-500 to-red-600":r>=75?"bg-gradient-to-r from-yellow-500 to-orange-500":"bg-gradient-to-r from-emerald-500 to-teal-500"},Z=d=>{const r=W(d);return r===null?"0%":`${r}%`},J=d=>{const r=W(d);return r===null?"--":`${r.toFixed(1)}%`},Y=d=>{if(!d)return"--";let r=d.remainingSeconds;if(r==null&&(r=d.resetAfterSeconds),r==null||Number.isNaN(Number(r)))return"--";r=Math.max(0,Math.floor(Number(r)));const y=Math.floor(r/86400),I=Math.floor(r%86400/3600),B=Math.floor(r%3600/60),g=r%60;return y>0?I>0?`${y}天${I}小时`:`${y}天`:I>0?B>0?`${I}小时${B}分钟`:`${I}小时`:B>0?`${B}分钟`:`${g}秒`},rt=d=>d==="secondary"?"周限":"5h";return(d,r)=>(a(),i("div",Qt,[t("div",Xt,[t("div",Zt,[t("header",te,[t("i",{class:j(["header-icon",e(m)?"fas fa-layer-group text-purple-500":"fas fa-info-circle text-blue-500"])},null,2),t("h3",ee,l(e(m)?"批量查询概要":"API Key 信息"),1)]),e(m)&&e(u)?(a(),i("div",se,[t("div",ae,[r[0]||(r[0]=t("p",{class:"info-label"},"查询 Keys 数",-1)),t("p",re,l(e(u).totalKeys)+" 个",1)]),t("div",le,[r[2]||(r[2]=t("p",{class:"info-label"},"有效 Keys 数",-1)),t("p",ie,[r[1]||(r[1]=t("i",{class:"fas fa-check-circle mr-1"},null,-1)),k(l(e(u).activeKeys)+" 个 ",1)])]),e(_).length>0?(a(),i("div",oe,[r[4]||(r[4]=t("p",{class:"info-label"},"无效 Keys 数",-1)),t("p",ne,[r[3]||(r[3]=t("i",{class:"fas fa-times-circle mr-1"},null,-1)),k(l(e(_).length)+" 个 ",1)])])):T("",!0),t("div",de,[r[5]||(r[5]=t("p",{class:"info-label"},"总请求数",-1)),t("p",ue,l(c(e(u).usage.requests)),1)]),t("div",ce,[r[6]||(r[6]=t("p",{class:"info-label"},"总 Token 数",-1)),t("p",me,l(c(e(u).usage.allTokens)),1)]),t("div",ge,[r[7]||(r[7]=t("p",{class:"info-label"},"总费用",-1)),t("p",xe,l(e(u).usage.formattedCost),1)]),e(b).length>1?(a(),i("div",fe,[r[8]||(r[8]=t("p",{class:"info-label"},"Top 3 贡献占比",-1)),t("div",ye,[(a(!0),i(G,null,tt(M.value,y=>(a(),i("div",{key:y.apiId,class:"contributor-item"},[t("span",pe,l(y.name),1),t("span",ve,l(v(y))+"%",1)]))),128))])])):T("",!0)])):(a(),i("div",be,[t("div",ke,[r[9]||(r[9]=t("p",{class:"info-label"},"名称",-1)),t("p",_e,l(e(s).name),1)]),t("div",he,[r[10]||(r[10]=t("p",{class:"info-label"},"状态",-1)),t("p",{class:j(["info-value font-semibold",e(s).isActive?"text-green-600 dark:text-emerald-400":"text-red-500 dark:text-red-400"])},[t("i",{class:j(["mr-1",e(s).isActive?"fas fa-check-circle":"fas fa-times-circle"])},null,2),k(" "+l(e(s).isActive?"活跃":"已停用"),1)],2)]),t("div",we,[r[11]||(r[11]=t("p",{class:"info-label"},"权限",-1)),t("p",$e,l(n(e(s).permissions)),1)]),t("div",Ce,[r[12]||(r[12]=t("p",{class:"info-label"},"创建时间",-1)),t("p",Se,l(A(e(s).createdAt)),1)]),t("div",Ke,[r[17]||(r[17]=t("p",{class:"info-label"},"过期时间",-1)),t("div",Ae,[e(s).expirationMode==="activation"&&!e(s).isActivated?(a(),i(G,{key:0},[r[13]||(r[13]=t("span",{class:"text-amber-600 dark:text-amber-400"},[t("i",{class:"fas fa-pause-circle mr-1"}),k("未激活 ")],-1)),t("span",Te," 首次使用后 "+l(e(s).activationDays||(e(s).activationUnit==="hours"?24:30))+" "+l(e(s).activationUnit==="hours"?"小时":"天")+"过期 ",1)],64)):e(s).expiresAt?(a(),i(G,{key:1},[$(e(s).expiresAt)?(a(),i("span",Le,r[14]||(r[14]=[t("i",{class:"fas fa-exclamation-circle mr-1"},null,-1),k("已过期 ",-1)]))):h(e(s).expiresAt)?(a(),i("span",Ie,[r[15]||(r[15]=t("i",{class:"fas fa-clock mr-1"},null,-1)),k(l(F(e(s).expiresAt)),1)])):(a(),i("span",Pe,l(F(e(s).expiresAt)),1))],64)):(a(),i("span",Me,r[16]||(r[16]=[t("i",{class:"fas fa-infinity mr-1"},null,-1),k("永不过期 ",-1)])))])])]))]),t("div",De,[t("header",qe,[r[18]||(r[18]=t("i",{class:"header-icon fas fa-chart-bar text-green-500"},null,-1)),r[19]||(r[19]=t("h3",{class:"header-title"},"使用统计概览",-1)),t("span",je,l(e(f)==="daily"?"今日":"本月"),1)]),t("div",Ue,[t("div",Re,[t("p",Oe,l(c(e(o).requests)),1),t("p",Ne,l(e(f)==="daily"?"今日":"本月")+"请求数",1)]),t("div",Ee,[t("p",Fe,l(c(e(o).allTokens)),1),t("p",Ve,l(e(f)==="daily"?"今日":"本月")+"Token 数",1)]),t("div",We,[t("p",Be,l(e(o).formattedCost||"$0.000000"),1),t("p",ze,l(e(f)==="daily"?"今日":"本月")+"费用",1)]),t("div",Je,[t("p",Ye,l(c(e(o).inputTokens)),1),t("p",He,l(e(f)==="daily"?"今日":"本月")+"输入 Token",1)])])])]),!e(m)&&D.value.length>0?(a(),i("div",Ge,[r[21]||(r[21]=t("header",{class:"section-header"},[t("i",{class:"header-icon fas fa-plug text-indigo-500"}),t("h3",{class:"header-title"},"专属账号运行状态"),t("span",{class:"header-tag"},"实时更新")],-1)),t("div",{class:j(["grid grid-cols-1 gap-4",x.value])},[(a(!0),i(G,null,tt(D.value,y=>{var I,B,g,w,U,z;return a(),i("div",{key:y.id||y.key,class:"account-card"},[t("div",Qe,[t("div",Xe,[t("span",{class:j(["account-icon",y.platform==="claude"?"icon-claude":"icon-openai"])},[t("i",{class:j(y.platform==="claude"?"fas fa-meteor":"fas fa-robot")},null,2)],2),t("div",null,[t("p",Ze,l(C(y)),1),t("p",ts,l(y.platform==="claude"?"会话窗口":"额度窗口"),1)])]),L(y.rateLimitStatus)?(a(),i("div",{key:0,class:j(["rate-badge",L(y.rateLimitStatus).class])},[r[20]||(r[20]=t("i",{class:"fas fa-tachometer-alt mr-1"},null,-1)),k(" "+l(L(y.rateLimitStatus).text),1)],2)):T("",!0)]),y.platform==="claude"?(a(),i("div",es,[t("div",ss,[t("div",as,[t("div",{class:j(["progress-bar",K((I=y.sessionWindow)==null?void 0:I.sessionWindowStatus,y)]),style:lt({width:`${Math.min(100,Math.max(0,((B=y.sessionWindow)==null?void 0:B.progress)||0))}%`})},null,6)]),t("span",rs,l(Math.min(100,Math.max(0,Math.round(((g=y.sessionWindow)==null?void 0:g.progress)||0))))+"% ",1)]),t("div",ls,[t("span",null,l(N((w=y.sessionWindow)==null?void 0:w.windowStart,(U=y.sessionWindow)==null?void 0:U.windowEnd)),1),((z=y.sessionWindow)==null?void 0:z.remainingTime)>0?(a(),i("span",is," 剩余 "+l(R(y.sessionWindow.remainingTime)),1)):T("",!0)])])):y.platform==="openai"?(a(),i("div",os,[y.codexUsage?(a(),i("div",ns,[(a(),i(G,null,tt(["primary","secondary"],E=>{var H,it,ct,mt;return t("div",{key:`${y.key}-${E}`,class:"quota-row"},[t("div",ds,[t("span",{class:j(["quota-tag",E==="primary"?"tag-indigo":"tag-blue"])},l(rt(E)),3),t("span",us,l(J((H=y.codexUsage)==null?void 0:H[E])),1)]),t("div",cs,[t("div",{class:j(["progress-bar",S((it=y.codexUsage)==null?void 0:it[E])]),style:lt({width:Z((ct=y.codexUsage)==null?void 0:ct[E])})},null,6)]),t("div",ms," 重置剩余 "+l(Y((mt=y.codexUsage)==null?void 0:mt[E])),1)])}),64))])):(a(),i("p",gs," 暂无额度使用数据 "))])):T("",!0)])}),128))],2)])):T("",!0)]))}},fs=et(xs,[["__scopeId","data-v-b72df2cd"]]),ys={class:"card p-4 md:p-6"},ps={class:"mb-3 flex flex-col text-lg font-bold text-gray-900 dark:text-gray-100 sm:flex-row sm:items-center md:mb-4 md:text-xl"},vs={class:"text-xs font-normal text-gray-600 dark:text-gray-400 sm:ml-2 md:text-sm"},bs={class:"space-y-2 md:space-y-3"},ks={class:"flex items-center justify-between"},_s={class:"text-sm font-medium text-gray-900 dark:text-gray-100 md:text-base"},hs={class:"flex items-center justify-between"},ws={class:"text-sm font-medium text-gray-900 dark:text-gray-100 md:text-base"},$s={class:"flex items-center justify-between"},Cs={class:"text-sm font-medium text-gray-900 dark:text-gray-100 md:text-base"},Ss={class:"flex items-center justify-between"},Ks={class:"text-sm font-medium text-gray-900 dark:text-gray-100 md:text-base"},As={class:"mt-3 border-t border-gray-200 pt-3 dark:border-gray-700 md:mt-4 md:pt-4"},Ts={class:"flex items-center justify-between font-bold text-gray-900 dark:text-gray-100"},Ls={class:"text-sm md:text-base"},Is={class:"text-lg md:text-xl"},Ps={__name:"TokenDistribution",setup(V){const p=at(),{statsPeriod:s,currentPeriodData:f}=st(p),o=m=>(typeof m!="number"&&(m=parseInt(m)||0),m===0?"0":m>=1e6?(m/1e6).toFixed(1)+"M":m>=1e3?(m/1e3).toFixed(1)+"K":m.toLocaleString());return(m,u)=>(a(),i("div",ys,[t("h3",ps,[u[0]||(u[0]=t("span",{class:"flex items-center"},[t("i",{class:"fas fa-coins mr-2 text-sm text-yellow-500 md:mr-3 md:text-base"}),k(" Token 使用分布 ")],-1)),t("span",vs,"("+l(e(s)==="daily"?"今日":"本月")+")",1)]),t("div",bs,[t("div",ks,[u[1]||(u[1]=t("span",{class:"flex items-center text-sm text-gray-600 dark:text-gray-400 md:text-base"},[t("i",{class:"fas fa-arrow-right mr-1 text-xs text-green-500 md:mr-2 md:text-sm"}),k(" 输入 Token ")],-1)),t("span",_s,l(o(e(f).inputTokens)),1)]),t("div",hs,[u[2]||(u[2]=t("span",{class:"flex items-center text-sm text-gray-600 dark:text-gray-400 md:text-base"},[t("i",{class:"fas fa-arrow-left mr-1 text-xs text-blue-500 md:mr-2 md:text-sm"}),k(" 输出 Token ")],-1)),t("span",ws,l(o(e(f).outputTokens)),1)]),t("div",$s,[u[3]||(u[3]=t("span",{class:"flex items-center text-sm text-gray-600 dark:text-gray-400 md:text-base"},[t("i",{class:"fas fa-save mr-1 text-xs text-purple-500 md:mr-2 md:text-sm"}),k(" 缓存创建 Token ")],-1)),t("span",Cs,l(o(e(f).cacheCreateTokens)),1)]),t("div",Ss,[u[4]||(u[4]=t("span",{class:"flex items-center text-sm text-gray-600 dark:text-gray-400 md:text-base"},[t("i",{class:"fas fa-download mr-1 text-xs text-orange-500 md:mr-2 md:text-sm"}),k(" 缓存读取 Token ")],-1)),t("span",Ks,l(o(e(f).cacheReadTokens)),1)])]),t("div",As,[t("div",Ts,[t("span",Ls,l(e(s)==="daily"?"今日":"本月")+"总计",1),t("span",Is,l(o(e(f).allTokens)),1)])])]))}},Ms=et(Ps,[["__scopeId","data-v-d9e5c1dd"]]),Ds={class:"flex h-full flex-col gap-4 md:gap-6"},qs={class:"card flex h-full flex-col p-4 md:p-6"},js={class:"mb-3 flex items-center text-lg font-bold text-gray-900 dark:text-gray-100 md:mb-4 md:text-xl"},Us={key:0,class:"space-y-4"},Rs={class:"rounded-lg bg-gradient-to-r from-blue-50 to-indigo-50 p-4 dark:from-blue-900/20 dark:to-indigo-900/20"},Os={class:"mb-3 flex items-center justify-between"},Ns={class:"rounded-full bg-blue-100 px-2 py-1 text-xs font-semibold text-blue-700 dark:bg-blue-800 dark:text-blue-200"},Es={class:"grid grid-cols-2 gap-3"},Fs={class:"text-center"},Vs={class:"text-lg font-bold text-gray-900 dark:text-gray-100"},Ws={class:"text-center"},Bs={class:"text-lg font-bold text-green-600"},zs={class:"rounded-lg bg-gradient-to-r from-purple-50 to-pink-50 p-4 dark:from-purple-900/20 dark:to-pink-900/20"},Js={class:"space-y-2"},Ys={class:"flex items-center justify-between"},Hs={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},Gs={class:"flex items-center justify-between"},Qs={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},Xs={class:"flex items-center justify-between"},Zs={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},ta={key:0,class:"rounded-lg bg-red-50 p-3 text-sm dark:bg-red-900/20"},ea={class:"text-red-700 dark:text-red-300"},sa={key:1,class:"space-y-4 md:space-y-5"},aa={class:"mb-2 flex items-center justify-between"},ra={class:"text-xs text-gray-500 dark:text-gray-400 md:text-sm"},la={key:0},ia={key:1,class:"flex items-center gap-1"},oa={key:0,class:"h-2 w-full rounded-full bg-gray-200 dark:bg-gray-700"},na={key:1,class:"h-2 w-full rounded-full bg-gray-200"},da={class:"mb-2 flex items-center justify-between"},ua={class:"text-xs text-gray-500 dark:text-gray-400 md:text-sm"},ca={key:0},ma={key:1,class:"flex items-center gap-1"},ga={key:0,class:"h-2 w-full rounded-full bg-gray-200 dark:bg-gray-700"},xa={key:1,class:"h-2 w-full rounded-full bg-gray-200"},fa={key:0},ya={class:"mb-2 flex items-center justify-between"},pa={class:"text-xs text-gray-500 dark:text-gray-400 md:text-sm"},va={class:"h-2 w-full rounded-full bg-gray-200 dark:bg-gray-700"},ba={key:1},ka={class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},_a={key:0},ha={key:1},wa={key:2},$a={class:"space-y-4 border-t border-gray-100 pt-3 dark:border-gray-700"},Ca={class:"flex items-center justify-between"},Sa={class:"text-sm font-medium text-gray-900 md:text-base"},Ka={key:0},Aa={key:1,class:"flex items-center gap-1"},Ta={class:"flex items-center justify-between"},La={class:"text-sm font-medium text-gray-900 md:text-base"},Ia={key:0,class:"text-orange-600"},Pa={key:1,class:"text-green-600"},Ma={class:"space-y-2"},Da={class:"flex items-center justify-between"},qa={class:"text-sm font-medium text-gray-900 md:text-base"},ja={key:0,class:"text-orange-600"},Ua={key:1,class:"text-green-600"},Ra={key:0,class:"flex flex-wrap gap-2 rounded-lg bg-blue-50 p-2 dark:bg-blue-900/20 md:p-3"},Oa={key:0,class:"card !overflow-visible p-4 md:p-6"},Na={class:"rounded-lg border border-amber-200 bg-amber-50 p-3 dark:border-amber-800 dark:bg-amber-900/20 md:p-4"},Ea={class:"max-h-64 space-y-1 overflow-y-auto pr-1 md:max-h-80 md:space-y-2"},Fa={class:"break-all text-gray-800 dark:text-gray-200"},Va={__name:"LimitConfig",setup(V){const p=at(),{statsData:s,multiKeyMode:f,aggregatedStats:o,invalidKeys:m}=st(p),u=O(()=>{var n;const c=(n=s.value)==null?void 0:n.restrictions;return c?c.enableModelRestriction===!0&&Array.isArray(c.restrictedModels)&&c.restrictedModels.length>0:!1}),b=O(()=>{var n;const c=(n=s.value)==null?void 0:n.restrictions;return c?c.enableClientRestriction===!0&&Array.isArray(c.allowedClients)&&c.allowedClients.length>0:!1}),_=()=>{if(!s.value.limits.dailyCostLimit||s.value.limits.dailyCostLimit===0)return 0;const c=s.value.limits.currentDailyCost/s.value.limits.dailyCostLimit*100;return Math.min(c,100)},M=()=>{const c=_();return c>=100?"bg-red-500":c>=80?"bg-yellow-500":"bg-green-500"},v=()=>{if(!s.value.limits.totalCostLimit||s.value.limits.totalCostLimit===0)return 0;const c=s.value.limits.currentTotalCost/s.value.limits.totalCostLimit*100;return Math.min(c,100)},A=()=>{const c=v();return c>=100?"bg-red-500":c>=80?"bg-yellow-500":"bg-blue-500"},F=()=>{if(!s.value.limits.weeklyOpusCostLimit||s.value.limits.weeklyOpusCostLimit===0)return 0;const c=s.value.limits.weeklyOpusCost/s.value.limits.weeklyOpusCostLimit*100;return Math.min(c,100)},$=()=>{const c=F();return c>=100?"bg-red-500":c>=80?"bg-yellow-500":"bg-indigo-500"},h=c=>(typeof c!="number"&&(c=parseInt(c)||0),c===0?"0":c>=1e6?(c/1e6).toFixed(1)+"M":c>=1e3?(c/1e3).toFixed(1)+"K":c.toLocaleString());return(c,n)=>(a(),i("div",Ds,[t("div",qs,[t("h3",js,[n[0]||(n[0]=t("i",{class:"fas fa-shield-alt mr-2 text-sm text-red-500 md:mr-3 md:text-base"},null,-1)),k(" "+l(e(f)?"限制配置（聚合查询模式）":"限制配置"),1)]),e(f)&&e(o)?(a(),i("div",Us,[t("div",Rs,[t("div",Os,[n[1]||(n[1]=t("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},[t("i",{class:"fas fa-layer-group mr-2 text-blue-500"}),k(" API Keys 概况 ")],-1)),t("span",Ns,l(e(o).activeKeys)+"/"+l(e(o).totalKeys),1)]),t("div",Es,[t("div",Fs,[t("div",Vs,l(e(o).totalKeys),1),n[2]||(n[2]=t("div",{class:"text-xs text-gray-600 dark:text-gray-400"},"总计 Keys",-1))]),t("div",Ws,[t("div",Bs,l(e(o).activeKeys),1),n[3]||(n[3]=t("div",{class:"text-xs text-gray-600 dark:text-gray-400"},"激活 Keys",-1))])])]),t("div",zs,[n[7]||(n[7]=t("div",{class:"mb-3 flex items-center"},[t("i",{class:"fas fa-chart-pie mr-2 text-purple-500"}),t("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"聚合统计摘要")],-1)),t("div",Js,[t("div",Ys,[n[4]||(n[4]=t("span",{class:"text-xs text-gray-600 dark:text-gray-400"},[t("i",{class:"fas fa-database mr-1 text-gray-400"}),k(" 总请求数 ")],-1)),t("span",Hs,l(h(e(o).usage.requests)),1)]),t("div",Gs,[n[5]||(n[5]=t("span",{class:"text-xs text-gray-600 dark:text-gray-400"},[t("i",{class:"fas fa-coins mr-1 text-yellow-500"}),k(" 总 Tokens ")],-1)),t("span",Qs,l(h(e(o).usage.allTokens)),1)]),t("div",Xs,[n[6]||(n[6]=t("span",{class:"text-xs text-gray-600 dark:text-gray-400"},[t("i",{class:"fas fa-dollar-sign mr-1 text-green-500"}),k(" 总费用 ")],-1)),t("span",Zs,l(e(o).usage.formattedCost),1)])])]),e(m)&&e(m).length>0?(a(),i("div",ta,[n[8]||(n[8]=t("i",{class:"fas fa-exclamation-triangle mr-2 text-red-600 dark:text-red-400"},null,-1)),t("span",ea,l(e(m).length)+" 个无效的 API Key ",1)])):T("",!0),n[9]||(n[9]=t("div",{class:"rounded-lg bg-gray-50 p-3 text-xs text-gray-600 dark:bg-gray-800 dark:text-gray-400"},[t("i",{class:"fas fa-info-circle mr-1"}),k(" 每个 API Key 有独立的限制设置，聚合模式下不显示单个限制配置 ")],-1))])):T("",!0),e(f)?T("",!0):(a(),i("div",sa,[t("div",null,[t("div",aa,[n[11]||(n[11]=t("span",{class:"text-sm font-medium text-gray-600 dark:text-gray-400 md:text-base"},"每日费用限制",-1)),t("span",ra,[e(s).limits.dailyCostLimit>0?(a(),i("span",la," $"+l(e(s).limits.currentDailyCost.toFixed(4))+" / $"+l(e(s).limits.dailyCostLimit.toFixed(2)),1)):(a(),i("span",ia,[k(" $"+l(e(s).limits.currentDailyCost.toFixed(4))+" / ",1),n[10]||(n[10]=t("i",{class:"fas fa-infinity"},null,-1))]))])]),e(s).limits.dailyCostLimit>0?(a(),i("div",oa,[t("div",{class:j(["h-2 rounded-full transition-all duration-300",M()]),style:lt({width:_()+"%"})},null,6)])):(a(),i("div",na,n[12]||(n[12]=[t("div",{class:"h-2 rounded-full bg-green-500",style:{width:"0%"}},null,-1)])))]),t("div",null,[t("div",da,[n[14]||(n[14]=t("span",{class:"text-sm font-medium text-gray-600 dark:text-gray-400 md:text-base"},"总费用限制",-1)),t("span",ua,[e(s).limits.totalCostLimit>0?(a(),i("span",ca," $"+l(e(s).limits.currentTotalCost.toFixed(4))+" / $"+l(e(s).limits.totalCostLimit.toFixed(2)),1)):(a(),i("span",ma,[k(" $"+l(e(s).limits.currentTotalCost.toFixed(4))+" / ",1),n[13]||(n[13]=t("i",{class:"fas fa-infinity"},null,-1))]))])]),e(s).limits.totalCostLimit>0?(a(),i("div",ga,[t("div",{class:j(["h-2 rounded-full transition-all duration-300",A()]),style:lt({width:v()+"%"})},null,6)])):(a(),i("div",xa,n[15]||(n[15]=[t("div",{class:"h-2 rounded-full bg-blue-500",style:{width:"0%"}},null,-1)])))]),e(s).limits.weeklyOpusCostLimit>0?(a(),i("div",fa,[t("div",ya,[n[16]||(n[16]=t("span",{class:"text-sm font-medium text-gray-600 dark:text-gray-400 md:text-base"},"Opus 模型周费用限制",-1)),t("span",pa," $"+l(e(s).limits.weeklyOpusCost.toFixed(4))+" / $"+l(e(s).limits.weeklyOpusCostLimit.toFixed(2)),1)]),t("div",va,[t("div",{class:j(["h-2 rounded-full transition-all duration-300",$()]),style:lt({width:F()+"%"})},null,6)])])):T("",!0),e(s).limits.rateLimitWindow>0&&(e(s).limits.rateLimitRequests>0||e(s).limits.tokenLimit>0||e(s).limits.rateLimitCost>0)?(a(),i("div",ba,[Q(At,{"cost-limit":e(s).limits.rateLimitCost,"current-cost":e(s).limits.currentWindowCost,"current-requests":e(s).limits.currentWindowRequests,"current-tokens":e(s).limits.currentWindowTokens,label:"时间窗口限制","rate-limit-window":e(s).limits.rateLimitWindow,"request-limit":e(s).limits.rateLimitRequests,"show-progress":!0,"show-tooltip":!0,"token-limit":e(s).limits.tokenLimit,"window-end-time":e(s).limits.windowEndTime,"window-remaining-seconds":e(s).limits.windowRemainingSeconds,"window-start-time":e(s).limits.windowStartTime},null,8,["cost-limit","current-cost","current-requests","current-tokens","rate-limit-window","request-limit","token-limit","window-end-time","window-remaining-seconds","window-start-time"]),t("div",ka,[n[17]||(n[17]=t("i",{class:"fas fa-info-circle mr-1"},null,-1)),e(s).limits.rateLimitCost>0?(a(),i("span",_a,' 请求次数和费用限制为"或"的关系，任一达到限制即触发限流 ')):e(s).limits.tokenLimit>0?(a(),i("span",ha,' 请求次数和Token使用量为"或"的关系，任一达到限制即触发限流 ')):(a(),i("span",wa," 仅限制请求次数 "))])])):T("",!0),t("div",$a,[t("div",Ca,[n[19]||(n[19]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400 md:text-base"},"并发限制",-1)),t("span",Sa,[e(s).limits.concurrencyLimit>0?(a(),i("span",Ka,l(e(s).limits.concurrencyLimit),1)):(a(),i("span",Aa,n[18]||(n[18]=[t("i",{class:"fas fa-infinity text-gray-400"},null,-1)])))])]),t("div",Ta,[n[22]||(n[22]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400 md:text-base"},"模型限制",-1)),t("span",La,[u.value?(a(),i("span",Ia,[n[20]||(n[20]=t("i",{class:"fas fa-exclamation-triangle mr-1 text-xs md:text-sm"},null,-1)),k(" 限制 "+l(e(s).restrictions.restrictedModels.length)+" 个模型 ",1)])):(a(),i("span",Pa,n[21]||(n[21]=[t("i",{class:"fas fa-check-circle mr-1 text-xs md:text-sm"},null,-1),k(" 允许所有模型 ",-1)])))])]),t("div",Ma,[t("div",Da,[n[25]||(n[25]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400 md:text-base"},"客户端限制",-1)),t("span",qa,[b.value?(a(),i("span",ja,[n[23]||(n[23]=t("i",{class:"fas fa-exclamation-triangle mr-1 text-xs md:text-sm"},null,-1)),k(" 限 "+l(e(s).restrictions.allowedClients.length)+" 种客户端使用 ",1)])):(a(),i("span",Ua,n[24]||(n[24]=[t("i",{class:"fas fa-check-circle mr-1 text-xs md:text-sm"},null,-1),k(" 允许所有客户端 ",-1)])))])]),b.value?(a(),i("div",Ra,[(a(!0),i(G,null,tt(e(s).restrictions.allowedClients,D=>(a(),i("span",{key:D,class:"flex items-center gap-1 rounded-full bg-white px-2 py-1 text-xs text-blue-700 shadow-sm dark:bg-slate-900 dark:text-blue-300 md:text-sm"},[n[26]||(n[26]=t("i",{class:"fas fa-id-badge"},null,-1)),k(" "+l(D),1)]))),128))])):T("",!0)])])]))]),u.value?(a(),i("div",Oa,[n[30]||(n[30]=t("h3",{class:"mb-3 flex items-center text-lg font-bold text-gray-900 dark:text-gray-100 md:mb-4 md:text-xl"},[t("i",{class:"fas fa-list-alt mr-2 text-sm text-amber-500 md:mr-3 md:text-base"}),k(" 详细限制信息 ")],-1)),t("div",Na,[n[28]||(n[28]=t("h4",{class:"mb-2 flex items-center text-sm font-bold text-amber-800 dark:text-amber-300 md:mb-3 md:text-base"},[t("i",{class:"fas fa-robot mr-1 text-xs md:mr-2 md:text-sm"}),k(" 受限模型列表 ")],-1)),t("div",Ea,[(a(!0),i(G,null,tt(e(s).restrictions.restrictedModels,D=>(a(),i("div",{key:D,class:"rounded border border-amber-200 bg-white px-2 py-1 text-xs dark:border-amber-700 dark:bg-gray-800 md:px-3 md:py-2 md:text-sm"},[n[27]||(n[27]=t("i",{class:"fas fa-ban mr-1 text-xs text-red-500 md:mr-2"},null,-1)),t("span",Fa,l(D),1)]))),128))]),n[29]||(n[29]=t("p",{class:"mt-2 text-xs text-amber-700 dark:text-amber-400 md:mt-3"},[t("i",{class:"fas fa-info-circle mr-1"}),k(" 此 API Key 不能访问以上列出的模型 ")],-1))])])):T("",!0)]))}},Wa=et(Va,[["__scopeId","data-v-9bba2ba4"]]),Ba={class:"card h-full p-4 md:p-6"},za={class:"mb-3 flex flex-col text-lg font-bold text-gray-900 dark:text-gray-100 sm:flex-row sm:items-center md:mb-4 md:text-xl"},Ja={class:"text-xs font-normal text-gray-600 dark:text-gray-400 sm:ml-2 md:text-sm"},Ya={key:0,class:"space-y-2 md:space-y-3"},Ha={class:"mb-1 flex items-center justify-between text-sm"},Ga={class:"truncate font-medium text-gray-700 dark:text-gray-300"},Qa={class:"text-xs text-gray-600 dark:text-gray-400"},Xa={class:"h-2 w-full rounded-full bg-gray-200 dark:bg-gray-700"},Za={class:"mt-1 flex items-center justify-between text-xs text-gray-500 dark:text-gray-400"},tr={key:0,class:"border-t border-gray-200 pt-2 dark:border-gray-700"},er={class:"flex items-center justify-between text-sm text-gray-600 dark:text-gray-400"},sr={key:1,class:"flex h-32 items-center justify-center text-sm text-gray-500 dark:text-gray-400"},ar={key:2,class:"flex h-32 items-center justify-center text-sm text-gray-500 dark:text-gray-400"},rr={__name:"AggregatedStatsCard",setup(V){const p=at(),{aggregatedStats:s,individualStats:f,statsPeriod:o,multiKeyMode:m}=st(p),u=$=>$?o.value==="daily"?$.dailyUsage||$.usage:$.monthlyUsage||$.usage:null,b=O(()=>!f.value||f.value.length===0?[]:[...f.value].sort(($,h)=>{const c=u($),n=u(h);return((n==null?void 0:n.cost)||0)-((c==null?void 0:c.cost)||0)}).slice(0,5)),_=O(()=>f.value?Math.max(0,f.value.length-5):0),M=O(()=>{var n,D;if(!f.value||!s.value)return 0;const $=b.value.reduce((x,C)=>{const q=u(C);return x+((q==null?void 0:q.cost)||0)},0),h=o.value==="daily"?((n=s.value.dailyUsage)==null?void 0:n.cost)||0:((D=s.value.monthlyUsage)==null?void 0:D.cost)||0;if(h===0)return 0;const c=h-$;return Math.max(0,Math.round(c/h*100))}),v=$=>{var D,x;if(!s.value)return 0;const h=o.value==="daily"?((D=s.value.dailyUsage)==null?void 0:D.cost)||0:((x=s.value.monthlyUsage)==null?void 0:x.cost)||0;if(h===0)return 0;const c=u($),n=((c==null?void 0:c.cost)||0)/h*100;return Math.round(n)},A=$=>["bg-blue-500","bg-green-500","bg-purple-500","bg-yellow-500","bg-pink-500"][$]||"bg-gray-400",F=$=>(typeof $!="number"&&($=parseInt($)||0),$===0?"0":$>=1e6?($/1e6).toFixed(1)+"M":$>=1e3?($/1e3).toFixed(1)+"K":$.toLocaleString());return($,h)=>(a(),i("div",Ba,[t("h3",za,[h[0]||(h[0]=t("span",{class:"flex items-center"},[t("i",{class:"fas fa-chart-pie mr-2 text-sm text-orange-500 md:mr-3 md:text-base"}),k(" 使用占比 ")],-1)),t("span",Ja,"("+l(e(o)==="daily"?"今日":"本月")+")",1)]),e(s)&&e(f).length>0?(a(),i("div",Ya,[(a(!0),i(G,null,tt(b.value,(c,n)=>{var D,x;return a(),i("div",{key:c.apiId,class:"relative"},[t("div",Ha,[t("span",Ga,l(c.name||`Key ${n+1}`),1),t("span",Qa,l(v(c))+"% ",1)]),t("div",Xa,[t("div",{class:j(["h-2 rounded-full transition-all duration-300",A(n)]),style:lt({width:v(c)+"%"})},null,6)]),t("div",Za,[t("span",null,l(F(((D=u(c))==null?void 0:D.requests)||0))+"次",1),t("span",null,l(((x=u(c))==null?void 0:x.formattedCost)||"$0.00"),1)])])}),128)),_.value>0?(a(),i("div",tr,[t("div",er,[t("span",null,"其他 "+l(_.value)+" 个Keys",1),t("span",null,l(M.value)+"%",1)])])):T("",!0)])):e(m)?(a(),i("div",ar,h[2]||(h[2]=[t("i",{class:"fas fa-chart-pie mr-2"},null,-1),k(" 暂无数据 ",-1)]))):(a(),i("div",sr,h[1]||(h[1]=[t("div",{class:"text-center"},[t("i",{class:"fas fa-chart-pie mb-2 text-2xl"}),t("p",null,"使用占比仅在多Key查询时显示")],-1)])))]))}},lr=et(rr,[["__scopeId","data-v-39572a8e"]]),ir={class:"card p-4 md:p-6"},or={class:"mb-4 md:mb-6"},nr={class:"flex flex-col text-lg font-bold text-gray-900 dark:text-gray-100 sm:flex-row sm:items-center md:text-xl"},dr={class:"text-xs font-normal text-gray-600 dark:text-gray-400 sm:ml-2 md:text-sm"},ur={key:0,class:"py-6 text-center md:py-8"},cr={key:1,class:"space-y-3 md:space-y-4"},mr={class:"mb-2 flex items-start justify-between md:mb-3"},gr={class:"min-w-0 flex-1"},xr={class:"break-all text-base font-bold text-gray-900 dark:text-gray-100 md:text-lg"},fr={class:"text-xs text-gray-600 dark:text-gray-400 md:text-sm"},yr={class:"ml-3 flex-shrink-0 text-right"},pr={class:"text-base font-bold text-green-600 md:text-lg"},vr={class:"grid grid-cols-2 gap-2 text-xs md:grid-cols-4 md:gap-3 md:text-sm"},br={class:"rounded bg-gray-50 p-2 dark:bg-gray-700"},kr={class:"font-medium text-gray-900 dark:text-gray-100"},_r={class:"rounded bg-gray-50 p-2 dark:bg-gray-700"},hr={class:"font-medium text-gray-900 dark:text-gray-100"},wr={class:"rounded bg-gray-50 p-2 dark:bg-gray-700"},$r={class:"font-medium text-gray-900 dark:text-gray-100"},Cr={class:"rounded bg-gray-50 p-2 dark:bg-gray-700"},Sr={class:"font-medium text-gray-900 dark:text-gray-100"},Kr={key:2,class:"py-6 text-center text-gray-500 dark:text-gray-400 md:py-8"},Ar={class:"text-sm md:text-base"},Tr={__name:"ModelUsageStats",setup(V){const p=at(),{statsPeriod:s,modelStats:f,modelStatsLoading:o}=st(p),m=u=>(typeof u!="number"&&(u=parseInt(u)||0),u===0?"0":u>=1e6?(u/1e6).toFixed(1)+"M":u>=1e3?(u/1e3).toFixed(1)+"K":u.toLocaleString());return(u,b)=>(a(),i("div",ir,[t("div",or,[t("h3",nr,[b[0]||(b[0]=t("span",{class:"flex items-center"},[t("i",{class:"fas fa-robot mr-2 text-sm text-indigo-500 md:mr-3 md:text-base"}),k(" 模型使用统计 ")],-1)),t("span",dr,"("+l(e(s)==="daily"?"今日":"本月")+")",1)])]),e(o)?(a(),i("div",ur,b[1]||(b[1]=[t("i",{class:"fas fa-spinner loading-spinner mb-2 text-xl text-gray-600 dark:text-gray-400 md:text-2xl"},null,-1),t("p",{class:"text-sm text-gray-600 dark:text-gray-400 md:text-base"},"加载模型统计数据中...",-1)]))):e(f).length>0?(a(),i("div",cr,[(a(!0),i(G,null,tt(e(f),(_,M)=>{var v;return a(),i("div",{key:M,class:"model-usage-item"},[t("div",mr,[t("div",gr,[t("h4",xr,l(_.model),1),t("p",fr,l(_.requests)+" 次请求 ",1)]),t("div",yr,[t("div",pr,l(((v=_.formatted)==null?void 0:v.total)||"$0.000000"),1),b[2]||(b[2]=t("div",{class:"text-xs text-gray-600 dark:text-gray-400 md:text-sm"},"总费用",-1))])]),t("div",vr,[t("div",br,[b[3]||(b[3]=t("div",{class:"text-gray-600 dark:text-gray-400"},"输入 Token",-1)),t("div",kr,l(m(_.inputTokens)),1)]),t("div",_r,[b[4]||(b[4]=t("div",{class:"text-gray-600 dark:text-gray-400"},"输出 Token",-1)),t("div",hr,l(m(_.outputTokens)),1)]),t("div",wr,[b[5]||(b[5]=t("div",{class:"text-gray-600 dark:text-gray-400"},"缓存创建",-1)),t("div",$r,l(m(_.cacheCreateTokens)),1)]),t("div",Cr,[b[6]||(b[6]=t("div",{class:"text-gray-600 dark:text-gray-400"},"缓存读取",-1)),t("div",Sr,l(m(_.cacheReadTokens)),1)])])])}),128))])):(a(),i("div",Kr,[b[7]||(b[7]=t("i",{class:"fas fa-chart-pie mb-3 text-2xl md:text-3xl"},null,-1)),t("p",Ar," 暂无"+l(e(s)==="daily"?"今日":"本月")+"模型使用数据 ",1)]))]))}},Lr=et(Tr,[["__scopeId","data-v-b3b8dc5f"]]),Ir={class:"merge-card mb-8 rounded-3xl p-6 shadow-xl"},Pr={class:"mx-auto max-w-4xl"},Mr={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},Dr=["disabled"],qr=["disabled"],jr={class:"mt-4 flex flex-wrap gap-3"},Ur=["disabled"],Rr={key:0,class:"fas fa-spinner loading-spinner"},Or={key:1,class:"fas fa-link"},Nr=["disabled"],Er={key:0,class:"mt-4"},Fr={class:"rounded-xl border border-red-500/30 bg-red-500/10 p-3 text-sm text-red-700 dark:border-red-500/20 dark:bg-red-500/10 dark:text-red-200"},Vr={key:1,class:"mt-4"},Wr={class:"rounded-xl border border-amber-400/40 bg-amber-50 p-3 text-sm text-amber-700 dark:border-amber-400/30 dark:bg-amber-900/20 dark:text-amber-200"},Br={class:"space-y-1"},zr={key:2,class:"mt-4"},Jr={class:"rounded-xl border border-emerald-400/40 bg-emerald-50 p-3 text-sm text-emerald-700 dark:border-emerald-400/30 dark:bg-emerald-900/20 dark:text-emerald-200"},Yr={class:"mb-2 font-semibold"},Hr={class:"space-y-1"},Gr={__name:"KeyMergePanel",setup(V){const p=P(""),s=P(""),f=P(!1),o=P(""),m=P(null),u=P([]),b=x=>x.length>=10&&x.length<=512,_=O(()=>{const x=p.value.trim(),C=s.value.trim();return!b(x)||!b(C)?!1:x!==C}),M={concurrencyLimit:"并发限制",rateLimitWindow:"速率窗口",rateLimitRequests:"窗口请求次数",rateLimitCost:"窗口费用限制",tokenLimit:"窗口 Token 限制",claudeAccountId:"Claude 账号绑定",claudeConsoleAccountId:"Claude Console 账号绑定",geminiAccountId:"Gemini 账号绑定",openaiAccountId:"OpenAI 账号绑定",azureOpenaiAccountId:"Azure OpenAI 账号绑定",bedrockAccountId:"Bedrock 账号绑定",droidAccountId:"Droid 账号绑定",permissions:"权限范围",enableModelRestriction:"模型限制开关",restrictedModels:"模型白名单",enableClientRestriction:"客户端限制开关",allowedClients:"允许客户端",tags:"标签",expirationMode:"过期模式",activationUnit:"激活单位",activationDays:"激活有效期",dailyCostLimit:"每日费用额度",totalCostLimit:"总费用额度",weeklyOpusCostLimit:"Opus 周费用额度",expiresAt:"到期时间"},v=x=>M[x]||x,A=(x,C)=>C==="permissions"&&Array.isArray(x)&&x.length===0?"全部":Array.isArray(x)?x.length?x.join(", "):"无":x===""||x===null||x===void 0?"无":String(x),F=(x,C=!1)=>{const q=C?x.source:x.target;return A(q,x.field)},$=O(()=>{var L;if(!((L=m.value)!=null&&L.merged))return[];const x=m.value.merged,C=x.activationUnit==="hours"?"小时":"天";return[{field:"totalCostLimit",label:"总费用额度",value:x.totalCostLimit},{field:"dailyCostLimit",label:"每日费用额度",value:x.dailyCostLimit},{field:"weeklyOpusCostLimit",label:"Opus 周费用额度",value:x.weeklyOpusCostLimit},{field:"rateLimitCost",label:"窗口费用限制",value:x.rateLimitCost},{field:"rateLimitRequests",label:"窗口请求次数",value:x.rateLimitRequests},{field:"tokenLimit",label:"窗口 Token 限制",value:x.tokenLimit},{field:"activationDays",label:"激活有效期",value:x.activationDays&&x.activationDays>0?`${x.activationDays} ${C}`:x.activationDays,rawValue:x.activationDays},{field:"expiresAt",label:"到期时间",value:x.expiresAt}].filter(N=>{if(N.field==="expiresAt")return N.value!==void 0&&N.value!==null&&N.value!=="";const R=Number(N.rawValue??N.value);return Number.isFinite(R)&&R>0}).map(N=>({...N,value:A(N.value,N.field)}))}),h=O(()=>{var x;return((x=m.value)==null?void 0:x.action)==="replace"?"替换成功":"融合成功"}),c=O(()=>{var x;return((x=m.value)==null?void 0:x.action)==="replace"?"旧密钥已替换为新密钥配置，新密钥已禁用。":"旧密钥额度已合并，新密钥已禁用。"}),n=async()=>{var x,C,q;if(!_.value){o.value="请填写有效的旧密钥和新密钥";return}f.value=!0,o.value="",m.value=null,u.value=[];try{const L=await X.mergeKeys({targetApiKey:p.value.trim(),sourceApiKey:s.value.trim()});if(L!=null&&L.success)m.value=L.data;else throw new Error((L==null?void 0:L.message)||"密钥融合失败")}catch(L){o.value=((x=L==null?void 0:L.data)==null?void 0:x.message)||(L==null?void 0:L.message)||"密钥融合失败",u.value=((q=(C=L==null?void 0:L.data)==null?void 0:C.details)==null?void 0:q.mismatchFields)||[]}finally{f.value=!1}},D=()=>{p.value="",s.value="",o.value="",m.value=null,u.value=[]};return ut([p,s],()=>{o.value&&(o.value=""),u.value=[],m.value=null}),(x,C)=>(a(),i("div",Ir,[C[8]||(C[8]=t("div",{class:"mb-6"},[t("h2",{class:"mb-2 text-2xl font-bold text-gray-900 dark:text-gray-200"},[t("i",{class:"fas fa-link mr-3"}),k(" 密钥融合 ")]),t("p",{class:"text-base text-gray-600 dark:text-gray-400"}," 将新密钥额度合并到旧密钥中；若旧密钥已禁用，则直接用新密钥配置替换旧密钥。完成后新密钥会被禁用。 ")],-1)),t("div",Pr,[t("div",Mr,[t("div",null,[C[2]||(C[2]=t("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"},[t("i",{class:"fas fa-key mr-2"}),k(" 旧密钥（保留使用） ")],-1)),nt(t("input",{"onUpdate:modelValue":C[0]||(C[0]=q=>p.value=q),class:"merge-input w-full",disabled:f.value,placeholder:"请输入旧密钥 (cr_...)",type:"password",autocomplete:"off"},null,8,Dr),[[dt,p.value]])]),t("div",null,[C[3]||(C[3]=t("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"},[t("i",{class:"fas fa-key mr-2"}),k(" 新密钥（将被禁用） ")],-1)),nt(t("input",{"onUpdate:modelValue":C[1]||(C[1]=q=>s.value=q),class:"merge-input w-full",disabled:f.value,placeholder:"请输入新密钥 (cr_...)",type:"password",autocomplete:"off"},null,8,qr),[[dt,s.value]])])]),t("div",jr,[t("button",{class:"merge-button flex items-center justify-center gap-2",disabled:f.value||!_.value,onClick:n},[f.value?(a(),i("i",Rr)):(a(),i("i",Or)),k(" "+l(f.value?"融合中...":"开始融合"),1)],8,Ur),t("button",{class:"merge-clear",disabled:f.value,onClick:D}," 清空输入 ",8,Nr)]),C[6]||(C[6]=t("div",{class:"merge-notice mt-4"},[t("i",{class:"fas fa-shield-alt mr-2"}),k(" 密钥融合仅在两把密钥设置一致且新密钥未使用时可执行（天卡有效期天数、按量总量额度允许不一致）；旧密钥已禁用时将直接替换配置并保留旧密钥。 ")],-1)),o.value?(a(),i("div",Er,[t("div",Fr,[C[4]||(C[4]=t("i",{class:"fas fa-exclamation-triangle mr-2"},null,-1)),k(" "+l(o.value),1)])])):T("",!0),u.value.length?(a(),i("div",Vr,[t("div",Wr,[C[5]||(C[5]=t("div",{class:"mb-2 font-semibold"},"以下设置不一致：",-1)),t("ul",Br,[(a(!0),i(G,null,tt(u.value,q=>(a(),i("li",{key:q.field},l(v(q.field))+"：旧= "+l(F(q))+"，新= "+l(F(q,!0)),1))),128))])])])):T("",!0),m.value?(a(),i("div",zr,[t("div",Jr,[t("div",Yr,l(h.value),1),t("div",Hr,[t("div",null,l(c.value),1),(a(!0),i(G,null,tt($.value,q=>(a(),i("div",{key:q.field},l(q.label)+"："+l(q.value),1))),128))])])])):T("",!0),C[7]||(C[7]=t("div",{class:"merge-notice mt-3 text-xs text-gray-500 dark:text-gray-400"},[t("i",{class:"fas fa-lock mr-2"}),k(" 密钥仅用于本次融合操作，不会被存储。 ")],-1))])]))}},Qr=et(Gr,[["__scopeId","data-v-966fb730"]]),Xr={key:0,class:"fixed inset-0 z-[1050] flex items-center justify-center bg-gray-900/40 backdrop-blur-sm"},Zr={class:"relative z-10 mx-3 flex w-full max-w-lg flex-col overflow-hidden rounded-2xl border border-gray-200/70 bg-white/95 shadow-2xl ring-1 ring-black/5 transition-all dark:border-gray-700/60 dark:bg-gray-900/95 dark:ring-white/10 sm:mx-4"},tl={class:"flex items-center justify-between border-b border-gray-100 bg-white/80 px-5 py-4 backdrop-blur dark:border-gray-800 dark:bg-gray-900/80"},el={class:"flex items-center gap-3"},sl={class:"text-xs text-gray-500 dark:text-gray-400"},al=["disabled"],rl={class:"max-h-[70vh] overflow-y-auto px-5 py-4"},ll={class:"mb-4"},il={class:"relative"},ol=["value"],nl={class:"mb-4 space-y-2"},dl={class:"flex items-center justify-between text-sm"},ul={class:"font-medium text-gray-700 dark:text-gray-300"},cl={class:"flex items-center gap-3"},ml={class:"text-xs text-gray-500 dark:text-gray-400"},gl={key:0,class:"mb-4 overflow-hidden rounded-xl border border-gray-200 bg-gray-50 dark:border-gray-700 dark:bg-gray-800/50"},xl={class:"flex items-center justify-between border-b border-gray-200 bg-gray-100 px-3 py-2 dark:border-gray-700 dark:bg-gray-800"},fl={key:0,class:"text-xs text-gray-500 dark:text-gray-500"},yl={class:"max-h-40 overflow-y-auto p-3"},pl={key:0,class:"whitespace-pre-wrap text-sm text-gray-700 dark:text-gray-300"},vl={key:0,class:"inline-block h-4 w-1 animate-pulse bg-blue-500"},bl={key:1,class:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400"},kl={key:2,class:"text-sm text-red-600 dark:text-red-400"},_l={key:1,class:"mb-4 flex items-center justify-center gap-2 text-xs text-gray-500 dark:text-gray-400"},hl={class:"flex items-center justify-end gap-3 border-t border-gray-100 bg-gray-50/80 px-5 py-3 dark:border-gray-800 dark:bg-gray-900/50"},wl=["disabled"],$l=["disabled"],Cl={__name:"ApiKeyTestModal",props:{show:{type:Boolean,default:!1},apiKeyValue:{type:String,default:""},apiKeyName:{type:String,default:""}},emits:["close"],setup(V,{emit:p}){const s=V,f=p,o=P("idle"),m=P(""),u=P(""),b=P(0),_=P(null),M=P(null),v=P("claude-sonnet-4-5-20250929"),A=O(()=>s.apiKeyName||"当前 API Key"),F=O(()=>{const R=s.apiKeyValue;return R?R.length<=10?"****":R.substring(0,6)+"****"+R.substring(R.length-4):""}),$=O(()=>{switch(o.value){case"idle":return"准备就绪";case"testing":return"正在测试...";case"success":return"测试成功";case"error":return"测试失败";default:return"未知状态"}}),h=O(()=>{switch(o.value){case"idle":return"点击下方按钮开始测试 API Key 连通性";case"testing":return"正在通过 /api 端点发送测试请求";case"success":return"API Key 可以正常访问服务";case"error":return u.value||"无法通过 API Key 访问服务";default:return""}}),c=O(()=>{switch(o.value){case"idle":return"border-gray-200 bg-gray-50 dark:border-gray-700 dark:bg-gray-800/50";case"testing":return"border-blue-200 bg-blue-50 dark:border-blue-500/30 dark:bg-blue-900/20";case"success":return"border-green-200 bg-green-50 dark:border-green-500/30 dark:bg-green-900/20";case"error":return"border-red-200 bg-red-50 dark:border-red-500/30 dark:bg-red-900/20";default:return"border-gray-200 bg-gray-50 dark:border-gray-700 dark:bg-gray-800/50"}}),n=O(()=>{switch(o.value){case"idle":return"bg-gray-200 dark:bg-gray-700";case"testing":return"bg-blue-100 dark:bg-blue-500/30";case"success":return"bg-green-100 dark:bg-green-500/30";case"error":return"bg-red-100 dark:bg-red-500/30";default:return"bg-gray-200 dark:bg-gray-700"}}),D=O(()=>{switch(o.value){case"idle":return"fa-hourglass-start";case"testing":return"fa-spinner fa-spin";case"success":return"fa-check-circle";case"error":return"fa-exclamation-circle";default:return"fa-question-circle"}}),x=O(()=>{switch(o.value){case"idle":return"text-gray-500 dark:text-gray-400";case"testing":return"text-blue-500 dark:text-blue-400";case"success":return"text-green-500 dark:text-green-400";case"error":return"text-red-500 dark:text-red-400";default:return"text-gray-500 dark:text-gray-400"}}),C=O(()=>{switch(o.value){case"idle":return"text-gray-700 dark:text-gray-300";case"testing":return"text-blue-700 dark:text-blue-300";case"success":return"text-green-700 dark:text-green-300";case"error":return"text-red-700 dark:text-red-300";default:return"text-gray-700 dark:text-gray-300"}});async function q(){if(!s.apiKeyValue)return;o.value="testing",m.value="",u.value="",b.value=0,_.value=Date.now(),M.value&&M.value.abort(),M.value=new AbortController;const R=`${wt}/apiStats/api-key/test`;try{const K=await fetch(R,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apiKey:s.apiKeyValue,model:v.value}),signal:M.value.signal});if(!K.ok){const J=await K.json().catch(()=>({}));throw new Error(J.message||J.error||`HTTP ${K.status}`)}const W=K.body.getReader(),S=new TextDecoder;let Z=!1;for(;!Z;){const{done:J,value:Y}=await W.read();if(J){Z=!0;continue}const d=S.decode(Y).split(`
`);for(const r of d)if(r.startsWith("data: "))try{const y=JSON.parse(r.substring(6));L(y)}catch{}}}catch(K){if(K.name==="AbortError")return;o.value="error",u.value=K.message||"连接失败",b.value=Date.now()-_.value}}function L(R){switch(R.type){case"test_start":break;case"content":m.value+=R.text;break;case"message_stop":break;case"test_complete":b.value=Date.now()-_.value,R.success?o.value="success":(o.value="error",u.value=R.error||"测试失败");break;case"error":o.value="error",u.value=R.error||"未知错误",b.value=Date.now()-_.value;break}}function N(){o.value!=="testing"&&(M.value&&(M.value.abort(),M.value=null),o.value="idle",m.value="",u.value="",b.value=0,f("close"))}return ut(()=>s.show,R=>{R&&(o.value="idle",m.value="",u.value="",b.value=0)}),yt(()=>{M.value&&M.value.abort()}),(R,K)=>(a(),ot(bt,{to:"body"},[V.show?(a(),i("div",Xr,[t("div",{class:"absolute inset-0",onClick:N}),t("div",Zr,[t("div",tl,[t("div",el,[t("div",{class:j(["flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-xl text-white shadow-lg",o.value==="success"?"bg-gradient-to-br from-green-500 to-emerald-500":o.value==="error"?"bg-gradient-to-br from-red-500 to-pink-500":"bg-gradient-to-br from-blue-500 to-indigo-500"])},[t("i",{class:j(["fas",o.value==="idle"?"fa-vial":o.value==="testing"?"fa-spinner fa-spin":o.value==="success"?"fa-check":"fa-times"])},null,2)],2),t("div",null,[K[0]||(K[0]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-gray-100"}," API Key 端点测试 ",-1)),t("p",sl,l(A.value),1)])]),t("button",{class:"flex h-9 w-9 items-center justify-center rounded-full bg-gray-100 text-gray-500 transition hover:bg-gray-200 hover:text-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-gray-200",disabled:o.value==="testing",onClick:N},K[1]||(K[1]=[t("i",{class:"fas fa-times text-sm"},null,-1)]),8,al)]),t("div",rl,[t("div",ll,[K[3]||(K[3]=t("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," API Key ",-1)),t("div",il,[t("input",{class:"w-full rounded-lg border border-gray-200 bg-gray-50 px-3 py-2 pr-10 text-sm text-gray-700 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",readonly:"",type:"text",value:F.value},null,8,ol),K[2]||(K[2]=t("div",{class:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400"},[t("i",{class:"fas fa-lock text-xs"})],-1))]),K[4]||(K[4]=t("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," 测试将使用此 API Key 调用当前服务的 /api 端点 ",-1))]),t("div",nl,[K[6]||(K[6]=t("div",{class:"flex items-center justify-between text-sm"},[t("span",{class:"text-gray-500 dark:text-gray-400"},"测试端点"),t("span",{class:"inline-flex items-center gap-1.5 rounded-full bg-blue-100 px-2.5 py-0.5 text-xs font-medium text-blue-700 dark:bg-blue-500/20 dark:text-blue-300"},[t("i",{class:"fas fa-link"}),k(" /api/v1/messages ")])],-1)),t("div",dl,[K[5]||(K[5]=t("span",{class:"text-gray-500 dark:text-gray-400"},"测试模型",-1)),t("span",ul,l(v.value),1)]),K[7]||(K[7]=t("div",{class:"flex items-center justify-between text-sm"},[t("span",{class:"text-gray-500 dark:text-gray-400"},"模拟客户端"),t("span",{class:"font-medium text-gray-700 dark:text-gray-300"},"Claude Code")],-1))]),t("div",{class:j(["mb-4 rounded-xl border p-4 transition-all duration-300",c.value])},[t("div",cl,[t("div",{class:j(["flex h-8 w-8 items-center justify-center rounded-lg",n.value])},[t("i",{class:j(["fas text-sm",D.value,x.value])},null,2)],2),t("div",null,[t("p",{class:j(["font-medium",C.value])},l($.value),3),t("p",ml,l(h.value),1)])])],2),o.value!=="idle"?(a(),i("div",gl,[t("div",xl,[K[8]||(K[8]=t("span",{class:"text-xs font-medium text-gray-600 dark:text-gray-400"},"AI 响应",-1)),m.value?(a(),i("span",fl,l(m.value.length)+" 字符 ",1)):T("",!0)]),t("div",yl,[m.value?(a(),i("p",pl,[k(l(m.value)+" ",1),o.value==="testing"?(a(),i("span",vl)):T("",!0)])):o.value==="testing"?(a(),i("p",bl,K[9]||(K[9]=[t("i",{class:"fas fa-circle-notch fa-spin"},null,-1),k(" 等待响应中... ",-1)]))):o.value==="error"&&u.value?(a(),i("p",kl,l(u.value),1)):T("",!0)])])):T("",!0),b.value>0?(a(),i("div",_l,[K[10]||(K[10]=t("i",{class:"fas fa-clock"},null,-1)),t("span",null,"耗时 "+l((b.value/1e3).toFixed(2))+" 秒",1)])):T("",!0)]),t("div",hl,[t("button",{class:"rounded-lg border border-gray-200 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm transition hover:bg-gray-50 hover:shadow dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700",disabled:o.value==="testing",onClick:N}," 关闭 ",8,wl),t("button",{class:j(["flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium shadow-sm transition",o.value==="testing"||!V.apiKeyValue?"cursor-not-allowed bg-gray-200 text-gray-400 dark:bg-gray-700 dark:text-gray-500":"bg-gradient-to-r from-blue-500 to-indigo-500 text-white hover:from-blue-600 hover:to-indigo-600 hover:shadow-md"]),disabled:o.value==="testing"||!V.apiKeyValue,onClick:q},[t("i",{class:j(["fas",o.value==="testing"?"fa-spinner fa-spin":"fa-play"])},null,2),k(" "+l(o.value==="testing"?"测试中...":o.value==="idle"?"开始测试":"重新测试"),1)],10,$l)])])])):T("",!0)]))}},Sl={class:"glass-strong mb-6 rounded-3xl p-4 shadow-xl md:mb-8 md:p-6"},Kl={class:"flex flex-col items-center justify-between gap-4 md:flex-row"},Al={class:"flex items-center gap-2 md:gap-4"},Tl={class:"flex items-center"},Ll={key:0,class:"h-8 w-px bg-gradient-to-b from-transparent via-gray-300 to-transparent opacity-50 dark:via-gray-600"},Il={class:"mb-6 md:mb-8"},Pl={class:"flex justify-center"},Ml={class:"inline-flex w-full max-w-lg rounded-full border border-white/20 bg-white/10 p-1 shadow-lg backdrop-blur-xl md:w-auto"},Dl={key:0,class:"tab-content"},ql={key:0,class:"mb-6 md:mb-8"},jl={class:"rounded-xl border border-red-500/30 bg-red-500/20 p-3 text-sm text-red-800 backdrop-blur-sm dark:border-red-500/20 dark:bg-red-500/10 dark:text-red-200 md:p-4 md:text-base"},Ul={key:1,class:"fade-in"},Rl={class:"glass-strong rounded-3xl p-4 shadow-xl md:p-6"},Ol={class:"mb-4 border-b border-gray-200 pb-4 dark:border-gray-700 md:mb-6 md:pb-6"},Nl={class:"flex flex-col items-start justify-between gap-3 md:flex-row md:items-center md:gap-4"},El={class:"flex w-full items-center gap-2 md:w-auto"},Fl=["disabled"],Vl=["disabled"],Wl=["disabled"],Bl={class:"mb-6 mt-6 grid grid-cols-1 gap-4 md:mb-8 md:mt-8 md:gap-6 xl:grid-cols-2 xl:items-stretch"},zl={key:1,class:"tab-content"},Jl={class:"glass-strong rounded-3xl shadow-xl"},Yl={key:2,class:"tab-content"},Hl={__name:"ApiStatsView",setup(V){const p=_t(),s=at(),f=$t(),o=P("stats"),m=O(()=>f.isDarkMode),{apiKey:u,apiId:b,loading:_,modelStatsLoading:M,oemLoading:v,error:A,statsPeriod:F,statsData:$,oemSettings:h,multiKeyMode:c}=st(s),{queryStats:n,switchPeriod:D,loadStatsWithApiId:x,loadOemSettings:C,reset:q}=s,L=P(!1),N=()=>{L.value=!0},R=()=>{L.value=!1},K=W=>{(W.ctrlKey||W.metaKey)&&W.key==="Enter"&&(!_.value&&u.value.trim()&&n(),W.preventDefault()),W.key==="Escape"&&q()};return kt(()=>{f.initTheme(),C();const W=p.query.apiId,S=p.query.apiKey;W&&W.match(/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/i)?(b.value=W,x()):S&&S.length>10&&(u.value=S),document.addEventListener("keydown",K)}),yt(()=>{document.removeEventListener("keydown",K)}),ut(u,W=>{W||s.clearData()}),(W,S)=>{var J;const Z=ht("router-link");return a(),i("div",{class:j(["min-h-screen p-4 md:p-6",m.value?"gradient-bg-dark":"gradient-bg"])},[t("div",Sl,[t("div",Kl,[Q(Ct,{loading:e(v),"logo-src":e(h).siteIconData||e(h).siteIcon,subtitle:o.value==="stats"?"API Key 使用统计":o.value==="merge"?"密钥融合":"使用教程",title:e(h).siteName},null,8,["loading","logo-src","subtitle","title"]),t("div",Al,[t("div",Tl,[Q(St,{mode:"dropdown"})]),e(h).ldapEnabled||e(h).showAdminButton!==!1?(a(),i("div",Ll)):T("",!0),e(h).ldapEnabled?(a(),ot(Z,{key:1,class:"user-login-button flex items-center gap-2 rounded-2xl px-4 py-2 text-white transition-all duration-300 md:px-5 md:py-2.5",to:"/user-login"},{default:ft(()=>S[5]||(S[5]=[t("i",{class:"fas fa-user text-sm md:text-base"},null,-1),t("span",{class:"text-xs font-semibold tracking-wide md:text-sm"},"用户登录",-1)])),_:1,__:[5]})):T("",!0),e(h).showAdminButton!==!1?(a(),ot(Z,{key:2,class:"admin-button-refined flex items-center gap-2 rounded-2xl px-4 py-2 transition-all duration-300 md:px-5 md:py-2.5",to:"/dashboard"},{default:ft(()=>S[6]||(S[6]=[t("i",{class:"fas fa-shield-alt text-sm md:text-base"},null,-1),t("span",{class:"text-xs font-semibold tracking-wide md:text-sm"},"管理后台",-1)])),_:1,__:[6]})):T("",!0)])])]),t("div",Il,[t("div",Pl,[t("div",Ml,[t("button",{class:j(["tab-pill-button",o.value==="stats"?"active":""]),onClick:S[0]||(S[0]=Y=>o.value="stats")},S[7]||(S[7]=[t("i",{class:"fas fa-chart-line mr-1 md:mr-2"},null,-1),t("span",{class:"text-sm md:text-base"},"统计查询",-1)]),2),t("button",{class:j(["tab-pill-button",o.value==="merge"?"active":""]),onClick:S[1]||(S[1]=Y=>o.value="merge")},S[8]||(S[8]=[t("i",{class:"fas fa-link mr-1 md:mr-2"},null,-1),t("span",{class:"text-sm md:text-base"},"密钥融合",-1)]),2),t("button",{class:j(["tab-pill-button",o.value==="tutorial"?"active":""]),onClick:S[2]||(S[2]=Y=>o.value="tutorial")},S[9]||(S[9]=[t("i",{class:"fas fa-graduation-cap mr-1 md:mr-2"},null,-1),t("span",{class:"text-sm md:text-base"},"使用教程",-1)]),2)])])]),o.value==="stats"?(a(),i("div",Dl,[Q(Gt),e(A)?(a(),i("div",ql,[t("div",jl,[S[10]||(S[10]=t("i",{class:"fas fa-exclamation-triangle mr-2"},null,-1)),k(" "+l(e(A)),1)])])):T("",!0),e($)?(a(),i("div",Ul,[t("div",Rl,[t("div",Ol,[t("div",Nl,[S[14]||(S[14]=t("div",{class:"flex items-center gap-2 md:gap-3"},[t("i",{class:"fas fa-clock text-base text-blue-500 md:text-lg"}),t("span",{class:"text-base font-medium text-gray-700 dark:text-gray-200 md:text-lg"},"统计时间范围")],-1)),t("div",El,[t("button",{class:j(["flex flex-1 items-center justify-center gap-1 px-4 py-2 text-xs font-medium md:flex-none md:gap-2 md:px-6 md:text-sm",["period-btn",{active:e(F)==="daily"}]]),disabled:e(_)||e(M),onClick:S[3]||(S[3]=Y=>e(D)("daily"))},S[11]||(S[11]=[t("i",{class:"fas fa-calendar-day text-xs md:text-sm"},null,-1),k(" 今日 ",-1)]),10,Fl),t("button",{class:j(["flex flex-1 items-center justify-center gap-1 px-4 py-2 text-xs font-medium md:flex-none md:gap-2 md:px-6 md:text-sm",["period-btn",{active:e(F)==="monthly"}]]),disabled:e(_)||e(M),onClick:S[4]||(S[4]=Y=>e(D)("monthly"))},S[12]||(S[12]=[t("i",{class:"fas fa-calendar-alt text-xs md:text-sm"},null,-1),k(" 本月 ",-1)]),10,Vl),e(c)?T("",!0):(a(),i("button",{key:0,class:"test-btn flex items-center justify-center gap-1 px-4 py-2 text-xs font-medium md:gap-2 md:px-6 md:text-sm",disabled:e(_),onClick:N},S[13]||(S[13]=[t("i",{class:"fas fa-vial text-xs md:text-sm"},null,-1),k(" 测试 ",-1)]),8,Wl))])])]),Q(fs),t("div",Bl,[Q(Ms,{class:"h-full"}),e(c)?(a(),ot(lr,{key:0,class:"h-full"})):(a(),ot(Wa,{key:1,class:"h-full"}))]),Q(Lr)])])):T("",!0)])):T("",!0),o.value==="tutorial"?(a(),i("div",zl,[t("div",Jl,[Q(Tt)])])):T("",!0),o.value==="merge"?(a(),i("div",Yl,[Q(Qr)])):T("",!0),Q(Cl,{"api-key-name":((J=e($))==null?void 0:J.name)||"","api-key-value":e(u),show:L.value,onClose:R},null,8,["api-key-name","api-key-value","show"])],2)}}},ri=et(Hl,[["__scopeId","data-v-0e73c45a"]]);export{ri as default};
