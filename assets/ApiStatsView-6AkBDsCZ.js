import{aP as vt,r as I,c as M,aX as at,x as o,y as l,z as t,O as k,L,P as i,u as e,C as O,K as it,aq as dt,aa as gt,f as xt,Y as bt,Q as J,ac as H,B as lt,R as Q,o as ut,V as pt,I as nt,aV as ft,a5 as kt,q as _t,aW as ht,J as yt,av as wt}from"./vue-vendor-R8HMg95E.js";import{_ as st,A as $t,a as Ct}from"./index-D9LVlE2P.js";import{L as St}from"./LogoTitle-XqyPfq8b.js";import{T as Kt}from"./ThemeToggle-DaxUpuRI.js";import{b as At}from"./vendor-Dr8jvgFu.js";import{_ as Lt}from"./WindowCountdown-DF7xS2EZ.js";import Tt from"./TutorialView-Cn2CrpRx.js";import"./element-plus-BUfCkBQO.js";class It{constructor(){this.baseURL=window.location.origin,this.isDev=!1}async request(v,a={}){try{this.isDev&&v.startsWith("/admin")&&(v="/webapi"+v);const y=await fetch(`${this.baseURL}${v}`,{headers:{"Content-Type":"application/json",...a.headers},...a}),c=await y.json();if(!y.ok){const n=new Error(c.message||`请求失败: ${y.status}`);throw n.data=c,n.status=y.status,n}return c}catch(y){throw console.error("API Stats request error:",y),y}}async getKeyId(v){return this.request("/apiStats/api/get-key-id",{method:"POST",body:JSON.stringify({apiKey:v})})}async getUserStats(v){return this.request("/apiStats/api/user-stats",{method:"POST",body:JSON.stringify({apiId:v})})}async getUserModelStats(v,a="daily"){return this.request("/apiStats/api/user-model-stats",{method:"POST",body:JSON.stringify({apiId:v,period:a})})}async getOemSettings(){try{return await this.request("/admin/oem-settings")}catch(v){return console.error("Failed to load OEM settings:",v),{success:!0,data:{siteName:"Claude Relay Service",siteIcon:"",siteIconData:""}}}}async getBatchStats(v){return this.request("/apiStats/api/batch-stats",{method:"POST",body:JSON.stringify({apiIds:v})})}async getBatchModelStats(v,a="daily"){return this.request("/apiStats/api/batch-model-stats",{method:"POST",body:JSON.stringify({apiIds:v,period:a})})}async mergeKeys(v){return this.request("/apiStats/api/merge-keys",{method:"POST",body:JSON.stringify(v)})}}const X=new It,rt=vt("apistats",()=>{const V=I(""),v=I(null),a=I(!1),y=I(!1),c=I(!0),n=I(""),m=I("daily"),b=I(null),_=I([]),j=I(null),x=I(null),$=I({siteName:"",siteIcon:"",siteIconData:""}),U=I(!1),C=I([]),w=I([]),u=I(null),d=I([]),D=I([]),f=M(()=>{const g={requests:0,inputTokens:0,outputTokens:0,cacheCreateTokens:0,cacheReadTokens:0,allTokens:0,cost:0,formattedCost:"$0.000000"};return U.value&&u.value?m.value==="daily"?u.value.dailyUsage||g:u.value.monthlyUsage||g:m.value==="daily"?j.value||g:x.value||g}),S=M(()=>{if(!b.value||!f.value)return{tokenUsage:0,costUsage:0,requestUsage:0};const g=f.value,h=b.value.limits;return{tokenUsage:h.tokenLimit>0?Math.min(g.allTokens/h.tokenLimit*100,100):0,costUsage:h.dailyCostLimit>0?Math.min(g.cost/h.dailyCostLimit*100,100):0,requestUsage:h.rateLimitRequests>0?Math.min(g.requests/h.rateLimitRequests*100,100):0}});async function q(){if(U.value)return z();const g=V.value.trim();if(!g){n.value="请输入 API Key";return}if(g.length<10||g.length>512){n.value="API Key 格式无效：长度应在 10-512 个字符之间";return}a.value=!0,n.value="",b.value=null,_.value=[],v.value=null;try{const h=await X.getKeyId(g);if(h.success){v.value=h.data.id;const P=await X.getUserStats(v.value);if(P.success)b.value=P.data,await T(),n.value="",et();else throw new Error(P.message||"查询失败")}else throw new Error(h.message||"获取 API Key ID 失败")}catch(h){console.error("Query stats error:",h),n.value=h.message||"查询统计数据失败，请检查您的 API Key 是否正确",b.value=null,_.value=[],v.value=null}finally{a.value=!1}}async function T(){v.value&&(await Promise.all([F("daily"),F("monthly")]),await G(m.value))}async function F(g){try{const h=await X.getUserModelStats(v.value,g);if(h.success){const P=h.data||[],B={requests:0,inputTokens:0,outputTokens:0,cacheCreateTokens:0,cacheReadTokens:0,allTokens:0,cost:0,formattedCost:"$0.000000"};P.forEach(E=>{var Y;B.requests+=E.requests||0,B.inputTokens+=E.inputTokens||0,B.outputTokens+=E.outputTokens||0,B.cacheCreateTokens+=E.cacheCreateTokens||0,B.cacheReadTokens+=E.cacheReadTokens||0,B.allTokens+=E.allTokens||0,B.cost+=((Y=E.costs)==null?void 0:Y.total)||0}),B.formattedCost=tt(B.cost),g==="daily"?j.value=B:x.value=B}else console.warn(`Failed to load ${g} stats:`,h.message)}catch(h){console.error(`Load ${g} stats error:`,h)}}async function G(g="daily"){if(v.value){y.value=!0;try{const h=await X.getUserModelStats(v.value,g);if(h.success)_.value=h.data||[];else throw new Error(h.message||"加载模型统计失败")}catch(h){console.error("Load model stats error:",h),_.value=[]}finally{y.value=!1}}}async function Z(g){if(!(m.value===g||y.value)){if(m.value=g,U.value&&w.value.length>0){await R(g);return}(g==="daily"&&!j.value||g==="monthly"&&!x.value)&&await F(g),await G(g)}}async function W(){var g,h;if(v.value){a.value=!0,n.value="",b.value=null,_.value=[];try{const P=await X.getUserStats(v.value);if(P.success)b.value=P.data,console.log("API Stats - Full response:",P.data),console.log("API Stats - limits data:",P.data.limits),console.log("API Stats - weeklyOpusCostLimit:",(g=P.data.limits)==null?void 0:g.weeklyOpusCostLimit),console.log("API Stats - weeklyOpusCost:",(h=P.data.limits)==null?void 0:h.weeklyOpusCost),await T(),n.value="";else throw new Error(P.message||"查询失败")}catch(P){console.error("Load stats with apiId error:",P),n.value=P.message||"查询统计数据失败",b.value=null,_.value=[]}finally{a.value=!1}}}async function K(){c.value=!0;try{const g=await X.getOemSettings();g&&g.success&&g.data&&($.value={...$.value,...g.data})}catch(g){console.error("Error loading OEM settings:",g),$.value={siteName:"Claude Relay Service",siteIcon:"",siteIconData:""}}finally{c.value=!1}}function tt(g){return typeof g!="number"||g===0?"$0.000000":g>=1?"$"+g.toFixed(2):g>=.01?"$"+g.toFixed(4):"$"+g.toFixed(6)}function et(){if(v.value){const g=new URL(window.location);g.searchParams.set("apiId",v.value),window.history.pushState({},"",g)}}async function z(){const g=s();if(g.length===0){n.value="请输入至少一个有效的 API Key";return}a.value=!0,n.value="",u.value=null,d.value=[],D.value=[],_.value=[],C.value=g,w.value=[];try{const h=await Promise.allSettled(g.map(Y=>X.getKeyId(Y))),P=[],B=[];if(h.forEach((Y,ot)=>{Y.status==="fulfilled"&&Y.value.success?(P.push(Y.value.data.id),B.push(g[ot])):D.value.push(g[ot])}),P.length===0)throw new Error("所有 API Key 都无效");w.value=P,C.value=B;const E=await X.getBatchStats(P);if(E.success)u.value=E.data.aggregated,d.value=E.data.individual,b.value=E.data.aggregated,j.value=E.data.aggregated.dailyUsage||null,x.value=E.data.aggregated.monthlyUsage||null,await R(m.value),r();else throw new Error(E.message||"批量查询失败")}catch(h){console.error("Batch query error:",h),n.value=h.message||"批量查询统计数据失败",u.value=null,d.value=[]}finally{a.value=!1}}async function R(g="daily"){if(w.value.length!==0){y.value=!0;try{const h=await X.getBatchModelStats(w.value,g);if(h.success)_.value=h.data||[];else throw new Error(h.message||"加载批量模型统计失败")}catch(h){console.error("Load batch model stats error:",h),_.value=[]}finally{y.value=!1}}}function s(){if(!V.value)return[];const g=V.value.split(/[,\n]+/).map(P=>P.trim()).filter(P=>P.length>=10&&P.length<=512);return[...new Set(g)].slice(0,30)}function r(){if(w.value.length>0){const g=new URL(window.location);g.searchParams.set("apiIds",w.value.join(",")),g.searchParams.set("batch","true"),window.history.pushState({},"",g)}}function p(){V.value=""}function A(){b.value=null,_.value=[],j.value=null,x.value=null,n.value="",m.value="daily",v.value=null,C.value=[],w.value=[],u.value=null,d.value=[],D.value=[]}function N(){V.value="",U.value=!1,A()}return{apiKey:V,apiId:v,loading:a,modelStatsLoading:y,oemLoading:c,error:n,statsPeriod:m,statsData:b,modelStats:_,dailyStats:j,monthlyStats:x,oemSettings:$,multiKeyMode:U,apiKeys:C,apiIds:w,aggregatedStats:u,individualStats:d,invalidKeys:D,currentPeriodData:f,usagePercentages:S,queryStats:q,queryBatchStats:z,loadAllPeriodStats:T,loadPeriodStats:F,loadModelStats:G,loadBatchModelStats:R,switchPeriod:Z,loadStatsWithApiId:W,loadOemSettings:K,clearData:A,clearInput:p,reset:N}}),Pt={class:"api-input-wide-card mb-8 rounded-3xl p-6 shadow-xl"},Mt={class:"mx-auto max-w-4xl"},Dt={class:"control-bar mb-4 flex flex-wrap items-center justify-between gap-3"},qt={class:"text-sm font-medium text-gray-700 dark:text-gray-300"},Ot={class:"button-group flex items-center gap-2"},jt={class:"mode-switch-group flex items-center rounded-lg bg-gray-100 p-1 dark:bg-gray-800"},Ut={key:0,class:"ml-1 rounded-full bg-white/20 px-1.5 py-0.5 text-xs font-semibold"},Rt={class:"api-input-grid grid grid-cols-1 gap-4 lg:grid-cols-4"},Nt={class:"lg:col-span-3"},Et=["disabled"],Ft={key:1,class:"relative"},Vt=["disabled"],Wt={class:"lg:col-span-1"},Bt=["disabled"],zt={key:0,class:"fas fa-spinner loading-spinner"},Jt={key:1,class:"fas fa-search"},Gt={class:"security-notice mt-4"},Yt={key:0,class:"mt-2 rounded-lg bg-blue-50 p-3 text-sm text-blue-700 dark:bg-blue-900/20 dark:text-blue-400"},Ht={__name:"ApiKeyInput",setup(V){const v=rt(),{apiKey:a,loading:y,multiKeyMode:c}=at(v),{queryStats:n,clearInput:m}=v,b=M(()=>{if(!c.value||!a.value)return[];const j=a.value.split(/[,\n]+/).map($=>$.trim()).filter($=>$.length>0);return[...new Set(j)].slice(0,30)}),_=M(()=>c.value?b.value.length>0:a.value&&a.value.trim().length>0);return(j,x)=>(l(),o("div",Pt,[x[15]||(x[15]=t("div",{class:"wide-card-title mb-6"},[t("h2",{class:"mb-2 text-2xl font-bold text-gray-900 dark:text-gray-200"},[t("i",{class:"fas fa-chart-line mr-3"}),k(" 使用统计查询 ")]),t("p",{class:"text-base text-gray-600 dark:text-gray-400"},"查询您的 API Key 使用情况和统计数据")],-1)),t("div",Mt,[t("div",Dt,[t("label",qt,[x[8]||(x[8]=t("i",{class:"fas fa-key mr-2"},null,-1)),k(" "+i(e(c)?"输入您的 API Keys（每行一个或用逗号分隔）":"输入您的 API Key"),1)]),t("div",Ot,[t("div",jt,[t("button",{class:O(["mode-switch-btn",{active:!e(c)}]),title:"单一模式",onClick:x[0]||(x[0]=$=>c.value=!1)},x[9]||(x[9]=[t("i",{class:"fas fa-key"},null,-1),t("span",{class:"ml-2 hidden sm:inline"},"单一",-1)]),2),t("button",{class:O(["mode-switch-btn",{active:e(c)}]),title:"聚合模式",onClick:x[1]||(x[1]=$=>c.value=!0)},[x[10]||(x[10]=t("i",{class:"fas fa-layer-group"},null,-1)),x[11]||(x[11]=t("span",{class:"ml-2 hidden sm:inline"},"聚合",-1)),e(c)&&b.value.length>0?(l(),o("span",Ut,i(b.value.length),1)):L("",!0)],2)])])]),t("div",Rt,[t("div",Nt,[e(c)?(l(),o("div",Ft,[it(t("textarea",{"onUpdate:modelValue":x[4]||(x[4]=$=>xt(a)?a.value=$:null),class:"wide-card-input w-full resize-y",disabled:e(y),placeholder:`请输入您的 API Keys，支持以下格式：
cr_xxx
cr_yyy
或
cr_xxx, cr_yyy`,rows:"4",onKeyup:x[5]||(x[5]=gt(bt((...$)=>e(n)&&e(n)(...$),["ctrl"]),["enter"]))},null,40,Vt),[[dt,e(a)]]),e(a)&&!e(y)?(l(),o("button",{key:0,class:"absolute right-2 top-2 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300",title:"清空输入",onClick:x[6]||(x[6]=(...$)=>e(m)&&e(m)(...$))},x[12]||(x[12]=[t("i",{class:"fas fa-times-circle"},null,-1)]))):L("",!0)])):it((l(),o("input",{key:0,"onUpdate:modelValue":x[2]||(x[2]=$=>xt(a)?a.value=$:null),class:"wide-card-input w-full",disabled:e(y),placeholder:"请输入您的 API Key (cr_...)",type:"password",onKeyup:x[3]||(x[3]=gt((...$)=>e(n)&&e(n)(...$),["enter"]))},null,40,Et)),[[dt,e(a)]])]),t("div",Wt,[t("button",{class:"btn btn-primary btn-query flex h-full w-full items-center justify-center gap-2",disabled:e(y)||!_.value,onClick:x[7]||(x[7]=(...$)=>e(n)&&e(n)(...$))},[e(y)?(l(),o("i",zt)):(l(),o("i",Jt)),k(" "+i(e(y)?"查询中...":"查询统计"),1)],8,Bt)])]),t("div",Gt,[x[13]||(x[13]=t("i",{class:"fas fa-shield-alt mr-2"},null,-1)),k(" "+i(e(c)?"您的 API Keys 仅用于查询统计数据，不会被存储。聚合模式下部分个体化信息将不显示。":"您的 API Key 仅用于查询自己的统计数据，不会被存储或用于其他用途"),1)]),e(c)?(l(),o("div",Yt,x[14]||(x[14]=[t("i",{class:"fas fa-lightbulb mr-2"},null,-1),t("span",null,"提示：最多支持同时查询 30 个 API Keys。使用 Ctrl+Enter 快速查询。",-1)]))):L("",!0)])]))}},Qt=st(Ht,[["__scopeId","data-v-11e74200"]]),Xt={class:"space-y-6 md:space-y-8"},Zt={class:"grid grid-cols-1 items-stretch gap-4 md:gap-6 xl:grid-cols-[minmax(0,1.5fr)_minmax(0,1fr)]"},te={class:"card-section"},ee={class:"section-header"},se={class:"header-title"},ae={key:0,class:"info-grid"},re={class:"info-item"},le={class:"info-value"},ie={class:"info-item"},oe={class:"info-value text-green-600 dark:text-emerald-400"},ne={key:0,class:"info-item"},de={class:"info-value text-red-500 dark:text-red-400"},ue={class:"info-item"},ce={class:"info-value"},me={class:"info-item"},ge={class:"info-value"},xe={class:"info-item"},fe={class:"info-value text-indigo-600 dark:text-indigo-300"},ye={key:1,class:"info-item xl:col-span-2"},pe={class:"space-y-2"},ve={class:"truncate"},be={class:"font-semibold"},ke={key:1,class:"info-grid"},_e={class:"info-item"},he={class:"info-value break-all"},we={class:"info-item"},$e={class:"info-item"},Ce={class:"info-value"},Se={class:"info-item"},Ke={class:"info-value break-all"},Ae={class:"info-item xl:col-span-2"},Le={class:"info-value"},Te={class:"ml-2 text-xs text-gray-500 dark:text-gray-400"},Ie={key:0,class:"text-red-500 dark:text-red-400"},Pe={key:1,class:"text-orange-500 dark:text-orange-400"},Me={key:2},De={key:2,class:"text-gray-400 dark:text-gray-500"},qe={class:"card-section"},Oe={class:"section-header"},je={class:"header-tag"},Ue={class:"metric-grid"},Re={class:"metric-card"},Ne={class:"metric-value text-green-600 dark:text-emerald-300"},Ee={class:"metric-label"},Fe={class:"metric-card"},Ve={class:"metric-value text-blue-600 dark:text-sky-300"},We={class:"metric-label"},Be={class:"metric-card"},ze={class:"metric-value text-purple-600 dark:text-violet-300"},Je={class:"metric-label"},Ge={class:"metric-card"},Ye={class:"metric-value text-amber-500 dark:text-amber-300"},He={class:"metric-label"},Qe={key:0,class:"card-section"},Xe={class:"flex items-center justify-between gap-3"},Ze={class:"flex items-center gap-3"},ts={class:"account-name"},es={class:"account-sub"},ss={key:0,class:"mt-3 space-y-2"},as={class:"progress-row"},rs={class:"progress-track"},ls={class:"progress-value"},is={class:"flex flex-wrap items-center gap-2 text-xs text-gray-600 dark:text-gray-300"},os={key:0,class:"font-medium text-indigo-600 dark:text-indigo-400"},ns={key:1,class:"mt-3"},ds={key:0,class:"space-y-2"},us={class:"quota-header"},cs={class:"quota-percent"},ms={class:"progress-track"},gs={class:"quota-foot"},xs={key:1,class:"rounded-xl bg-slate-100 px-3 py-2 text-xs text-slate-500 dark:bg-slate-800 dark:text-slate-300"},fs={__name:"StatsOverview",setup(V){const v=rt(),{statsData:a,statsPeriod:y,currentPeriodData:c,multiKeyMode:n,aggregatedStats:m,individualStats:b,invalidKeys:_}=at(v),j=M(()=>!b.value||b.value.length===0?[]:[...b.value].sort((s,r)=>{var p,A;return(((p=r.usage)==null?void 0:p.allTokens)||0)-(((A=s.usage)==null?void 0:A.allTokens)||0)}).slice(0,3)),x=s=>{var p;return!m.value||!m.value.usage.allTokens?0:((((p=s.usage)==null?void 0:p.allTokens)||0)/m.value.usage.allTokens*100).toFixed(1)},$=s=>{if(!s)return"无";try{return At(s).format("YYYY年MM月DD日 HH:mm")}catch{return"格式错误"}},U=s=>s?new Date(s).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",C=s=>s?new Date(s)<new Date:!1,w=s=>{if(!s)return!1;const A=(new Date(s)-new Date)/(1e3*60*60*24);return A>0&&A<=7},u=s=>(typeof s!="number"&&(s=parseInt(s)||0),s===0?"0":s>=1e6?(s/1e6).toFixed(1)+"M":s>=1e3?(s/1e3).toFixed(1)+"K":s.toLocaleString()),d=s=>({claude:"Claude",gemini:"Gemini",all:"全部模型"})[s]||s||"未知",D=M(()=>{var p,A;const s=(A=(p=a.value)==null?void 0:p.accounts)==null?void 0:A.details;if(!s)return[];const r=[];return s.claude&&s.claude.accountType==="dedicated"&&r.push({key:"claude",...s.claude}),s.openai&&s.openai.accountType==="dedicated"&&r.push({key:"openai",...s.openai}),r}),f=M(()=>{const s=D.value.length;return s<=1?"md:grid-cols-1 lg:grid-cols-1":s===2?"md:grid-cols-2":"md:grid-cols-2 xl:grid-cols-3"}),S=s=>s?s.platform==="openai"?"OpenAI 专属账号":"Claude 专属账号":"专属账号",q=s=>{if(!s||s<=0)return"";const r=Math.floor(s),p=Math.floor(r/1440),A=Math.floor(r%1440/60),N=r%60;return p>0?A>0?`${p}天${A}小时`:`${p}天`:A>0?N>0?`${A}小时${N}分钟`:`${A}小时`:`${N}分钟`},T=s=>{if(!s)return{text:"状态未知",class:"text-gray-400"};if(s.isRateLimited){const r=q(s.minutesRemaining);return{text:`限流中${r?` · 剩余约 ${r}`:""}`,class:"text-red-500 dark:text-red-400"}}return{text:"未限流",class:"text-green-600 dark:text-emerald-400"}},F=(s,r)=>{if(!s||!r)return"暂无时间窗口信息";const p=new Date(s),A=new Date(r),N=g=>`${`${g.getHours()}`.padStart(2,"0")}:${`${g.getMinutes()}`.padStart(2,"0")}`;return`${N(p)} - ${N(A)}`},G=s=>{if(!s||s<=0)return"";const r=Math.floor(s/60),p=s%60;return r>0?`${r}小时${p}分钟`:`${p}分钟`},Z=(s,r)=>{var A;if(!s)return"bg-gradient-to-r from-blue-500 to-indigo-500";if((A=r==null?void 0:r.rateLimitStatus)!=null&&A.isRateLimited)return"bg-gradient-to-r from-red-500 to-red-600";const p=String(s).toLowerCase();return p==="rejected"?"bg-gradient-to-r from-red-500 to-red-600":p==="allowed_warning"?"bg-gradient-to-r from-yellow-500 to-orange-500":"bg-gradient-to-r from-blue-500 to-indigo-500"},W=s=>{if(!s)return null;const r=typeof s.usedPercent=="number"&&!Number.isNaN(s.usedPercent)?s.usedPercent:null,p=typeof s.resetAfterSeconds=="number"&&!Number.isNaN(s.resetAfterSeconds)?s.resetAfterSeconds:null,A=typeof s.remainingSeconds=="number"?s.remainingSeconds:null,N=s.resetAt?Date.parse(s.resetAt):null;return p!==null&&(A!==null&&A<=0||N!==null&&!Number.isNaN(N)&&Date.now()>=N)?0:r===null?null:Math.max(0,Math.min(100,r))},K=s=>{const r=W(s);return r===null?"bg-gradient-to-r from-gray-300 to-gray-400":r>=90?"bg-gradient-to-r from-red-500 to-red-600":r>=75?"bg-gradient-to-r from-yellow-500 to-orange-500":"bg-gradient-to-r from-emerald-500 to-teal-500"},tt=s=>{const r=W(s);return r===null?"0%":`${r}%`},et=s=>{const r=W(s);return r===null?"--":`${r.toFixed(1)}%`},z=s=>{if(!s)return"--";let r=s.remainingSeconds;if(r==null&&(r=s.resetAfterSeconds),r==null||Number.isNaN(Number(r)))return"--";r=Math.max(0,Math.floor(Number(r)));const p=Math.floor(r/86400),A=Math.floor(r%86400/3600),N=Math.floor(r%3600/60),g=r%60;return p>0?A>0?`${p}天${A}小时`:`${p}天`:A>0?N>0?`${A}小时${N}分钟`:`${A}小时`:N>0?`${N}分钟`:`${g}秒`},R=s=>s==="secondary"?"周限":"5h";return(s,r)=>(l(),o("div",Xt,[t("div",Zt,[t("div",te,[t("header",ee,[t("i",{class:O(["header-icon",e(n)?"fas fa-layer-group text-purple-500":"fas fa-info-circle text-blue-500"])},null,2),t("h3",se,i(e(n)?"批量查询概要":"API Key 信息"),1)]),e(n)&&e(m)?(l(),o("div",ae,[t("div",re,[r[0]||(r[0]=t("p",{class:"info-label"},"查询 Keys 数",-1)),t("p",le,i(e(m).totalKeys)+" 个",1)]),t("div",ie,[r[2]||(r[2]=t("p",{class:"info-label"},"有效 Keys 数",-1)),t("p",oe,[r[1]||(r[1]=t("i",{class:"fas fa-check-circle mr-1"},null,-1)),k(i(e(m).activeKeys)+" 个 ",1)])]),e(_).length>0?(l(),o("div",ne,[r[4]||(r[4]=t("p",{class:"info-label"},"无效 Keys 数",-1)),t("p",de,[r[3]||(r[3]=t("i",{class:"fas fa-times-circle mr-1"},null,-1)),k(i(e(_).length)+" 个 ",1)])])):L("",!0),t("div",ue,[r[5]||(r[5]=t("p",{class:"info-label"},"总请求数",-1)),t("p",ce,i(u(e(m).usage.requests)),1)]),t("div",me,[r[6]||(r[6]=t("p",{class:"info-label"},"总 Token 数",-1)),t("p",ge,i(u(e(m).usage.allTokens)),1)]),t("div",xe,[r[7]||(r[7]=t("p",{class:"info-label"},"总费用",-1)),t("p",fe,i(e(m).usage.formattedCost),1)]),e(b).length>1?(l(),o("div",ye,[r[8]||(r[8]=t("p",{class:"info-label"},"Top 3 贡献占比",-1)),t("div",pe,[(l(!0),o(J,null,H(j.value,p=>(l(),o("div",{key:p.apiId,class:"contributor-item"},[t("span",ve,i(p.name),1),t("span",be,i(x(p))+"%",1)]))),128))])])):L("",!0)])):(l(),o("div",ke,[t("div",_e,[r[9]||(r[9]=t("p",{class:"info-label"},"名称",-1)),t("p",he,i(e(a).name),1)]),t("div",we,[r[10]||(r[10]=t("p",{class:"info-label"},"状态",-1)),t("p",{class:O(["info-value font-semibold",e(a).isActive?"text-green-600 dark:text-emerald-400":"text-red-500 dark:text-red-400"])},[t("i",{class:O(["mr-1",e(a).isActive?"fas fa-check-circle":"fas fa-times-circle"])},null,2),k(" "+i(e(a).isActive?"活跃":"已停用"),1)],2)]),t("div",$e,[r[11]||(r[11]=t("p",{class:"info-label"},"权限",-1)),t("p",Ce,i(d(e(a).permissions)),1)]),t("div",Se,[r[12]||(r[12]=t("p",{class:"info-label"},"创建时间",-1)),t("p",Ke,i($(e(a).createdAt)),1)]),t("div",Ae,[r[17]||(r[17]=t("p",{class:"info-label"},"过期时间",-1)),t("div",Le,[e(a).expirationMode==="activation"&&!e(a).isActivated?(l(),o(J,{key:0},[r[13]||(r[13]=t("span",{class:"text-amber-600 dark:text-amber-400"},[t("i",{class:"fas fa-pause-circle mr-1"}),k("未激活 ")],-1)),t("span",Te," 首次使用后 "+i(e(a).activationDays||(e(a).activationUnit==="hours"?24:30))+" "+i(e(a).activationUnit==="hours"?"小时":"天")+"过期 ",1)],64)):e(a).expiresAt?(l(),o(J,{key:1},[C(e(a).expiresAt)?(l(),o("span",Ie,r[14]||(r[14]=[t("i",{class:"fas fa-exclamation-circle mr-1"},null,-1),k("已过期 ",-1)]))):w(e(a).expiresAt)?(l(),o("span",Pe,[r[15]||(r[15]=t("i",{class:"fas fa-clock mr-1"},null,-1)),k(i(U(e(a).expiresAt)),1)])):(l(),o("span",Me,i(U(e(a).expiresAt)),1))],64)):(l(),o("span",De,r[16]||(r[16]=[t("i",{class:"fas fa-infinity mr-1"},null,-1),k("永不过期 ",-1)])))])])]))]),t("div",qe,[t("header",Oe,[r[18]||(r[18]=t("i",{class:"header-icon fas fa-chart-bar text-green-500"},null,-1)),r[19]||(r[19]=t("h3",{class:"header-title"},"使用统计概览",-1)),t("span",je,i(e(y)==="daily"?"今日":"本月"),1)]),t("div",Ue,[t("div",Re,[t("p",Ne,i(u(e(c).requests)),1),t("p",Ee,i(e(y)==="daily"?"今日":"本月")+"请求数",1)]),t("div",Fe,[t("p",Ve,i(u(e(c).allTokens)),1),t("p",We,i(e(y)==="daily"?"今日":"本月")+"Token 数",1)]),t("div",Be,[t("p",ze,i(e(c).formattedCost||"$0.000000"),1),t("p",Je,i(e(y)==="daily"?"今日":"本月")+"费用",1)]),t("div",Ge,[t("p",Ye,i(u(e(c).inputTokens)),1),t("p",He,i(e(y)==="daily"?"今日":"本月")+"输入 Token",1)])])])]),!e(n)&&D.value.length>0?(l(),o("div",Qe,[r[21]||(r[21]=t("header",{class:"section-header"},[t("i",{class:"header-icon fas fa-plug text-indigo-500"}),t("h3",{class:"header-title"},"专属账号运行状态"),t("span",{class:"header-tag"},"实时更新")],-1)),t("div",{class:O(["grid grid-cols-1 gap-4",f.value])},[(l(!0),o(J,null,H(D.value,p=>{var A,N,g,h,P,B;return l(),o("div",{key:p.id||p.key,class:"account-card"},[t("div",Xe,[t("div",Ze,[t("span",{class:O(["account-icon",p.platform==="claude"?"icon-claude":"icon-openai"])},[t("i",{class:O(p.platform==="claude"?"fas fa-meteor":"fas fa-robot")},null,2)],2),t("div",null,[t("p",ts,i(S(p)),1),t("p",es,i(p.platform==="claude"?"会话窗口":"额度窗口"),1)])]),T(p.rateLimitStatus)?(l(),o("div",{key:0,class:O(["rate-badge",T(p.rateLimitStatus).class])},[r[20]||(r[20]=t("i",{class:"fas fa-tachometer-alt mr-1"},null,-1)),k(" "+i(T(p.rateLimitStatus).text),1)],2)):L("",!0)]),p.platform==="claude"?(l(),o("div",ss,[t("div",as,[t("div",rs,[t("div",{class:O(["progress-bar",Z((A=p.sessionWindow)==null?void 0:A.sessionWindowStatus,p)]),style:lt({width:`${Math.min(100,Math.max(0,((N=p.sessionWindow)==null?void 0:N.progress)||0))}%`})},null,6)]),t("span",ls,i(Math.min(100,Math.max(0,Math.round(((g=p.sessionWindow)==null?void 0:g.progress)||0))))+"% ",1)]),t("div",is,[t("span",null,i(F((h=p.sessionWindow)==null?void 0:h.windowStart,(P=p.sessionWindow)==null?void 0:P.windowEnd)),1),((B=p.sessionWindow)==null?void 0:B.remainingTime)>0?(l(),o("span",os," 剩余 "+i(G(p.sessionWindow.remainingTime)),1)):L("",!0)])])):p.platform==="openai"?(l(),o("div",ns,[p.codexUsage?(l(),o("div",ds,[(l(),o(J,null,H(["primary","secondary"],E=>{var Y,ot,ct,mt;return t("div",{key:`${p.key}-${E}`,class:"quota-row"},[t("div",us,[t("span",{class:O(["quota-tag",E==="primary"?"tag-indigo":"tag-blue"])},i(R(E)),3),t("span",cs,i(et((Y=p.codexUsage)==null?void 0:Y[E])),1)]),t("div",ms,[t("div",{class:O(["progress-bar",K((ot=p.codexUsage)==null?void 0:ot[E])]),style:lt({width:tt((ct=p.codexUsage)==null?void 0:ct[E])})},null,6)]),t("div",gs," 重置剩余 "+i(z((mt=p.codexUsage)==null?void 0:mt[E])),1)])}),64))])):(l(),o("p",xs," 暂无额度使用数据 "))])):L("",!0)])}),128))],2)])):L("",!0)]))}},ys=st(fs,[["__scopeId","data-v-b72df2cd"]]),ps={class:"card p-4 md:p-6"},vs={class:"mb-3 flex flex-col text-lg font-bold text-gray-900 dark:text-gray-100 sm:flex-row sm:items-center md:mb-4 md:text-xl"},bs={class:"text-xs font-normal text-gray-600 dark:text-gray-400 sm:ml-2 md:text-sm"},ks={class:"space-y-2 md:space-y-3"},_s={class:"flex items-center justify-between"},hs={class:"text-sm font-medium text-gray-900 dark:text-gray-100 md:text-base"},ws={class:"flex items-center justify-between"},$s={class:"text-sm font-medium text-gray-900 dark:text-gray-100 md:text-base"},Cs={class:"flex items-center justify-between"},Ss={class:"text-sm font-medium text-gray-900 dark:text-gray-100 md:text-base"},Ks={class:"flex items-center justify-between"},As={class:"text-sm font-medium text-gray-900 dark:text-gray-100 md:text-base"},Ls={class:"mt-3 border-t border-gray-200 pt-3 dark:border-gray-700 md:mt-4 md:pt-4"},Ts={class:"flex items-center justify-between font-bold text-gray-900 dark:text-gray-100"},Is={class:"text-sm md:text-base"},Ps={class:"text-lg md:text-xl"},Ms={__name:"TokenDistribution",setup(V){const v=rt(),{statsPeriod:a,currentPeriodData:y}=at(v),c=n=>(typeof n!="number"&&(n=parseInt(n)||0),n===0?"0":n>=1e6?(n/1e6).toFixed(1)+"M":n>=1e3?(n/1e3).toFixed(1)+"K":n.toLocaleString());return(n,m)=>(l(),o("div",ps,[t("h3",vs,[m[0]||(m[0]=t("span",{class:"flex items-center"},[t("i",{class:"fas fa-coins mr-2 text-sm text-yellow-500 md:mr-3 md:text-base"}),k(" Token 使用分布 ")],-1)),t("span",bs,"("+i(e(a)==="daily"?"今日":"本月")+")",1)]),t("div",ks,[t("div",_s,[m[1]||(m[1]=t("span",{class:"flex items-center text-sm text-gray-600 dark:text-gray-400 md:text-base"},[t("i",{class:"fas fa-arrow-right mr-1 text-xs text-green-500 md:mr-2 md:text-sm"}),k(" 输入 Token ")],-1)),t("span",hs,i(c(e(y).inputTokens)),1)]),t("div",ws,[m[2]||(m[2]=t("span",{class:"flex items-center text-sm text-gray-600 dark:text-gray-400 md:text-base"},[t("i",{class:"fas fa-arrow-left mr-1 text-xs text-blue-500 md:mr-2 md:text-sm"}),k(" 输出 Token ")],-1)),t("span",$s,i(c(e(y).outputTokens)),1)]),t("div",Cs,[m[3]||(m[3]=t("span",{class:"flex items-center text-sm text-gray-600 dark:text-gray-400 md:text-base"},[t("i",{class:"fas fa-save mr-1 text-xs text-purple-500 md:mr-2 md:text-sm"}),k(" 缓存创建 Token ")],-1)),t("span",Ss,i(c(e(y).cacheCreateTokens)),1)]),t("div",Ks,[m[4]||(m[4]=t("span",{class:"flex items-center text-sm text-gray-600 dark:text-gray-400 md:text-base"},[t("i",{class:"fas fa-download mr-1 text-xs text-orange-500 md:mr-2 md:text-sm"}),k(" 缓存读取 Token ")],-1)),t("span",As,i(c(e(y).cacheReadTokens)),1)])]),t("div",Ls,[t("div",Ts,[t("span",Is,i(e(a)==="daily"?"今日":"本月")+"总计",1),t("span",Ps,i(c(e(y).allTokens)),1)])])]))}},Ds=st(Ms,[["__scopeId","data-v-d9e5c1dd"]]),qs={class:"flex h-full flex-col gap-4 md:gap-6"},Os={class:"card flex h-full flex-col p-4 md:p-6"},js={class:"mb-3 flex items-center text-lg font-bold text-gray-900 dark:text-gray-100 md:mb-4 md:text-xl"},Us={key:0,class:"space-y-4"},Rs={class:"rounded-lg bg-gradient-to-r from-blue-50 to-indigo-50 p-4 dark:from-blue-900/20 dark:to-indigo-900/20"},Ns={class:"mb-3 flex items-center justify-between"},Es={class:"rounded-full bg-blue-100 px-2 py-1 text-xs font-semibold text-blue-700 dark:bg-blue-800 dark:text-blue-200"},Fs={class:"grid grid-cols-2 gap-3"},Vs={class:"text-center"},Ws={class:"text-lg font-bold text-gray-900 dark:text-gray-100"},Bs={class:"text-center"},zs={class:"text-lg font-bold text-green-600"},Js={class:"rounded-lg bg-gradient-to-r from-purple-50 to-pink-50 p-4 dark:from-purple-900/20 dark:to-pink-900/20"},Gs={class:"space-y-2"},Ys={class:"flex items-center justify-between"},Hs={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},Qs={class:"flex items-center justify-between"},Xs={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},Zs={class:"flex items-center justify-between"},ta={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},ea={key:0,class:"rounded-lg bg-red-50 p-3 text-sm dark:bg-red-900/20"},sa={class:"text-red-700 dark:text-red-300"},aa={key:1,class:"space-y-4 md:space-y-5"},ra={class:"mb-2 flex items-center justify-between"},la={class:"text-xs text-gray-500 dark:text-gray-400 md:text-sm"},ia={key:0},oa={key:1,class:"flex items-center gap-1"},na={key:0,class:"h-2 w-full rounded-full bg-gray-200 dark:bg-gray-700"},da={key:1,class:"h-2 w-full rounded-full bg-gray-200"},ua={class:"mb-2 flex items-center justify-between"},ca={class:"text-xs text-gray-500 dark:text-gray-400 md:text-sm"},ma={key:0},ga={key:1,class:"flex items-center gap-1"},xa={key:0,class:"h-2 w-full rounded-full bg-gray-200 dark:bg-gray-700"},fa={key:1,class:"h-2 w-full rounded-full bg-gray-200"},ya={key:0},pa={class:"mb-2 flex items-center justify-between"},va={class:"text-xs text-gray-500 dark:text-gray-400 md:text-sm"},ba={class:"h-2 w-full rounded-full bg-gray-200 dark:bg-gray-700"},ka={key:1},_a={class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},ha={key:0},wa={key:1},$a={key:2},Ca={class:"space-y-4 border-t border-gray-100 pt-3 dark:border-gray-700"},Sa={class:"flex items-center justify-between"},Ka={class:"text-sm font-medium text-gray-900 md:text-base"},Aa={key:0},La={key:1,class:"flex items-center gap-1"},Ta={class:"flex items-center justify-between"},Ia={class:"text-sm font-medium text-gray-900 md:text-base"},Pa={key:0,class:"text-orange-600"},Ma={key:1,class:"text-green-600"},Da={class:"space-y-2"},qa={class:"flex items-center justify-between"},Oa={class:"text-sm font-medium text-gray-900 md:text-base"},ja={key:0,class:"text-orange-600"},Ua={key:1,class:"text-green-600"},Ra={key:0,class:"flex flex-wrap gap-2 rounded-lg bg-blue-50 p-2 dark:bg-blue-900/20 md:p-3"},Na={key:0,class:"card !overflow-visible p-4 md:p-6"},Ea={class:"rounded-lg border border-amber-200 bg-amber-50 p-3 dark:border-amber-800 dark:bg-amber-900/20 md:p-4"},Fa={class:"max-h-64 space-y-1 overflow-y-auto pr-1 md:max-h-80 md:space-y-2"},Va={class:"break-all text-gray-800 dark:text-gray-200"},Wa={__name:"LimitConfig",setup(V){const v=rt(),{statsData:a,multiKeyMode:y,aggregatedStats:c,invalidKeys:n}=at(v),m=M(()=>{var d;const u=(d=a.value)==null?void 0:d.restrictions;return u?u.enableModelRestriction===!0&&Array.isArray(u.restrictedModels)&&u.restrictedModels.length>0:!1}),b=M(()=>{var d;const u=(d=a.value)==null?void 0:d.restrictions;return u?u.enableClientRestriction===!0&&Array.isArray(u.allowedClients)&&u.allowedClients.length>0:!1}),_=()=>{if(!a.value.limits.dailyCostLimit||a.value.limits.dailyCostLimit===0)return 0;const u=a.value.limits.currentDailyCost/a.value.limits.dailyCostLimit*100;return Math.min(u,100)},j=()=>{const u=_();return u>=100?"bg-red-500":u>=80?"bg-yellow-500":"bg-green-500"},x=()=>{if(!a.value.limits.totalCostLimit||a.value.limits.totalCostLimit===0)return 0;const u=a.value.limits.currentTotalCost/a.value.limits.totalCostLimit*100;return Math.min(u,100)},$=()=>{const u=x();return u>=100?"bg-red-500":u>=80?"bg-yellow-500":"bg-blue-500"},U=()=>{if(!a.value.limits.weeklyOpusCostLimit||a.value.limits.weeklyOpusCostLimit===0)return 0;const u=a.value.limits.weeklyOpusCost/a.value.limits.weeklyOpusCostLimit*100;return Math.min(u,100)},C=()=>{const u=U();return u>=100?"bg-red-500":u>=80?"bg-yellow-500":"bg-indigo-500"},w=u=>(typeof u!="number"&&(u=parseInt(u)||0),u===0?"0":u>=1e6?(u/1e6).toFixed(1)+"M":u>=1e3?(u/1e3).toFixed(1)+"K":u.toLocaleString());return(u,d)=>(l(),o("div",qs,[t("div",Os,[t("h3",js,[d[0]||(d[0]=t("i",{class:"fas fa-shield-alt mr-2 text-sm text-red-500 md:mr-3 md:text-base"},null,-1)),k(" "+i(e(y)?"限制配置（聚合查询模式）":"限制配置"),1)]),e(y)&&e(c)?(l(),o("div",Us,[t("div",Rs,[t("div",Ns,[d[1]||(d[1]=t("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},[t("i",{class:"fas fa-layer-group mr-2 text-blue-500"}),k(" API Keys 概况 ")],-1)),t("span",Es,i(e(c).activeKeys)+"/"+i(e(c).totalKeys),1)]),t("div",Fs,[t("div",Vs,[t("div",Ws,i(e(c).totalKeys),1),d[2]||(d[2]=t("div",{class:"text-xs text-gray-600 dark:text-gray-400"},"总计 Keys",-1))]),t("div",Bs,[t("div",zs,i(e(c).activeKeys),1),d[3]||(d[3]=t("div",{class:"text-xs text-gray-600 dark:text-gray-400"},"激活 Keys",-1))])])]),t("div",Js,[d[7]||(d[7]=t("div",{class:"mb-3 flex items-center"},[t("i",{class:"fas fa-chart-pie mr-2 text-purple-500"}),t("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"聚合统计摘要")],-1)),t("div",Gs,[t("div",Ys,[d[4]||(d[4]=t("span",{class:"text-xs text-gray-600 dark:text-gray-400"},[t("i",{class:"fas fa-database mr-1 text-gray-400"}),k(" 总请求数 ")],-1)),t("span",Hs,i(w(e(c).usage.requests)),1)]),t("div",Qs,[d[5]||(d[5]=t("span",{class:"text-xs text-gray-600 dark:text-gray-400"},[t("i",{class:"fas fa-coins mr-1 text-yellow-500"}),k(" 总 Tokens ")],-1)),t("span",Xs,i(w(e(c).usage.allTokens)),1)]),t("div",Zs,[d[6]||(d[6]=t("span",{class:"text-xs text-gray-600 dark:text-gray-400"},[t("i",{class:"fas fa-dollar-sign mr-1 text-green-500"}),k(" 总费用 ")],-1)),t("span",ta,i(e(c).usage.formattedCost),1)])])]),e(n)&&e(n).length>0?(l(),o("div",ea,[d[8]||(d[8]=t("i",{class:"fas fa-exclamation-triangle mr-2 text-red-600 dark:text-red-400"},null,-1)),t("span",sa,i(e(n).length)+" 个无效的 API Key ",1)])):L("",!0),d[9]||(d[9]=t("div",{class:"rounded-lg bg-gray-50 p-3 text-xs text-gray-600 dark:bg-gray-800 dark:text-gray-400"},[t("i",{class:"fas fa-info-circle mr-1"}),k(" 每个 API Key 有独立的限制设置，聚合模式下不显示单个限制配置 ")],-1))])):L("",!0),e(y)?L("",!0):(l(),o("div",aa,[t("div",null,[t("div",ra,[d[11]||(d[11]=t("span",{class:"text-sm font-medium text-gray-600 dark:text-gray-400 md:text-base"},"每日费用限制",-1)),t("span",la,[e(a).limits.dailyCostLimit>0?(l(),o("span",ia," $"+i(e(a).limits.currentDailyCost.toFixed(4))+" / $"+i(e(a).limits.dailyCostLimit.toFixed(2)),1)):(l(),o("span",oa,[k(" $"+i(e(a).limits.currentDailyCost.toFixed(4))+" / ",1),d[10]||(d[10]=t("i",{class:"fas fa-infinity"},null,-1))]))])]),e(a).limits.dailyCostLimit>0?(l(),o("div",na,[t("div",{class:O(["h-2 rounded-full transition-all duration-300",j()]),style:lt({width:_()+"%"})},null,6)])):(l(),o("div",da,d[12]||(d[12]=[t("div",{class:"h-2 rounded-full bg-green-500",style:{width:"0%"}},null,-1)])))]),t("div",null,[t("div",ua,[d[14]||(d[14]=t("span",{class:"text-sm font-medium text-gray-600 dark:text-gray-400 md:text-base"},"总费用限制",-1)),t("span",ca,[e(a).limits.totalCostLimit>0?(l(),o("span",ma," $"+i(e(a).limits.currentTotalCost.toFixed(4))+" / $"+i(e(a).limits.totalCostLimit.toFixed(2)),1)):(l(),o("span",ga,[k(" $"+i(e(a).limits.currentTotalCost.toFixed(4))+" / ",1),d[13]||(d[13]=t("i",{class:"fas fa-infinity"},null,-1))]))])]),e(a).limits.totalCostLimit>0?(l(),o("div",xa,[t("div",{class:O(["h-2 rounded-full transition-all duration-300",$()]),style:lt({width:x()+"%"})},null,6)])):(l(),o("div",fa,d[15]||(d[15]=[t("div",{class:"h-2 rounded-full bg-blue-500",style:{width:"0%"}},null,-1)])))]),e(a).limits.weeklyOpusCostLimit>0?(l(),o("div",ya,[t("div",pa,[d[16]||(d[16]=t("span",{class:"text-sm font-medium text-gray-600 dark:text-gray-400 md:text-base"},"Opus 模型周费用限制",-1)),t("span",va," $"+i(e(a).limits.weeklyOpusCost.toFixed(4))+" / $"+i(e(a).limits.weeklyOpusCostLimit.toFixed(2)),1)]),t("div",ba,[t("div",{class:O(["h-2 rounded-full transition-all duration-300",C()]),style:lt({width:U()+"%"})},null,6)])])):L("",!0),e(a).limits.rateLimitWindow>0&&(e(a).limits.rateLimitRequests>0||e(a).limits.tokenLimit>0||e(a).limits.rateLimitCost>0)?(l(),o("div",ka,[Q(Lt,{"cost-limit":e(a).limits.rateLimitCost,"current-cost":e(a).limits.currentWindowCost,"current-requests":e(a).limits.currentWindowRequests,"current-tokens":e(a).limits.currentWindowTokens,label:"时间窗口限制","rate-limit-window":e(a).limits.rateLimitWindow,"request-limit":e(a).limits.rateLimitRequests,"show-progress":!0,"show-tooltip":!0,"token-limit":e(a).limits.tokenLimit,"window-end-time":e(a).limits.windowEndTime,"window-remaining-seconds":e(a).limits.windowRemainingSeconds,"window-start-time":e(a).limits.windowStartTime},null,8,["cost-limit","current-cost","current-requests","current-tokens","rate-limit-window","request-limit","token-limit","window-end-time","window-remaining-seconds","window-start-time"]),t("div",_a,[d[17]||(d[17]=t("i",{class:"fas fa-info-circle mr-1"},null,-1)),e(a).limits.rateLimitCost>0?(l(),o("span",ha,' 请求次数和费用限制为"或"的关系，任一达到限制即触发限流 ')):e(a).limits.tokenLimit>0?(l(),o("span",wa,' 请求次数和Token使用量为"或"的关系，任一达到限制即触发限流 ')):(l(),o("span",$a," 仅限制请求次数 "))])])):L("",!0),t("div",Ca,[t("div",Sa,[d[19]||(d[19]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400 md:text-base"},"并发限制",-1)),t("span",Ka,[e(a).limits.concurrencyLimit>0?(l(),o("span",Aa,i(e(a).limits.concurrencyLimit),1)):(l(),o("span",La,d[18]||(d[18]=[t("i",{class:"fas fa-infinity text-gray-400"},null,-1)])))])]),t("div",Ta,[d[22]||(d[22]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400 md:text-base"},"模型限制",-1)),t("span",Ia,[m.value?(l(),o("span",Pa,[d[20]||(d[20]=t("i",{class:"fas fa-exclamation-triangle mr-1 text-xs md:text-sm"},null,-1)),k(" 限制 "+i(e(a).restrictions.restrictedModels.length)+" 个模型 ",1)])):(l(),o("span",Ma,d[21]||(d[21]=[t("i",{class:"fas fa-check-circle mr-1 text-xs md:text-sm"},null,-1),k(" 允许所有模型 ",-1)])))])]),t("div",Da,[t("div",qa,[d[25]||(d[25]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400 md:text-base"},"客户端限制",-1)),t("span",Oa,[b.value?(l(),o("span",ja,[d[23]||(d[23]=t("i",{class:"fas fa-exclamation-triangle mr-1 text-xs md:text-sm"},null,-1)),k(" 限 "+i(e(a).restrictions.allowedClients.length)+" 种客户端使用 ",1)])):(l(),o("span",Ua,d[24]||(d[24]=[t("i",{class:"fas fa-check-circle mr-1 text-xs md:text-sm"},null,-1),k(" 允许所有客户端 ",-1)])))])]),b.value?(l(),o("div",Ra,[(l(!0),o(J,null,H(e(a).restrictions.allowedClients,D=>(l(),o("span",{key:D,class:"flex items-center gap-1 rounded-full bg-white px-2 py-1 text-xs text-blue-700 shadow-sm dark:bg-slate-900 dark:text-blue-300 md:text-sm"},[d[26]||(d[26]=t("i",{class:"fas fa-id-badge"},null,-1)),k(" "+i(D),1)]))),128))])):L("",!0)])])]))]),m.value?(l(),o("div",Na,[d[30]||(d[30]=t("h3",{class:"mb-3 flex items-center text-lg font-bold text-gray-900 dark:text-gray-100 md:mb-4 md:text-xl"},[t("i",{class:"fas fa-list-alt mr-2 text-sm text-amber-500 md:mr-3 md:text-base"}),k(" 详细限制信息 ")],-1)),t("div",Ea,[d[28]||(d[28]=t("h4",{class:"mb-2 flex items-center text-sm font-bold text-amber-800 dark:text-amber-300 md:mb-3 md:text-base"},[t("i",{class:"fas fa-robot mr-1 text-xs md:mr-2 md:text-sm"}),k(" 受限模型列表 ")],-1)),t("div",Fa,[(l(!0),o(J,null,H(e(a).restrictions.restrictedModels,D=>(l(),o("div",{key:D,class:"rounded border border-amber-200 bg-white px-2 py-1 text-xs dark:border-amber-700 dark:bg-gray-800 md:px-3 md:py-2 md:text-sm"},[d[27]||(d[27]=t("i",{class:"fas fa-ban mr-1 text-xs text-red-500 md:mr-2"},null,-1)),t("span",Va,i(D),1)]))),128))]),d[29]||(d[29]=t("p",{class:"mt-2 text-xs text-amber-700 dark:text-amber-400 md:mt-3"},[t("i",{class:"fas fa-info-circle mr-1"}),k(" 此 API Key 不能访问以上列出的模型 ")],-1))])])):L("",!0)]))}},Ba=st(Wa,[["__scopeId","data-v-9bba2ba4"]]),za={class:"card h-full p-4 md:p-6"},Ja={class:"mb-3 flex flex-col text-lg font-bold text-gray-900 dark:text-gray-100 sm:flex-row sm:items-center md:mb-4 md:text-xl"},Ga={class:"text-xs font-normal text-gray-600 dark:text-gray-400 sm:ml-2 md:text-sm"},Ya={key:0,class:"space-y-2 md:space-y-3"},Ha={class:"mb-1 flex items-center justify-between text-sm"},Qa={class:"truncate font-medium text-gray-700 dark:text-gray-300"},Xa={class:"text-xs text-gray-600 dark:text-gray-400"},Za={class:"h-2 w-full rounded-full bg-gray-200 dark:bg-gray-700"},tr={class:"mt-1 flex items-center justify-between text-xs text-gray-500 dark:text-gray-400"},er={key:0,class:"border-t border-gray-200 pt-2 dark:border-gray-700"},sr={class:"flex items-center justify-between text-sm text-gray-600 dark:text-gray-400"},ar={key:1,class:"flex h-32 items-center justify-center text-sm text-gray-500 dark:text-gray-400"},rr={key:2,class:"flex h-32 items-center justify-center text-sm text-gray-500 dark:text-gray-400"},lr={__name:"AggregatedStatsCard",setup(V){const v=rt(),{aggregatedStats:a,individualStats:y,statsPeriod:c,multiKeyMode:n}=at(v),m=C=>C?c.value==="daily"?C.dailyUsage||C.usage:C.monthlyUsage||C.usage:null,b=M(()=>!y.value||y.value.length===0?[]:[...y.value].sort((C,w)=>{const u=m(C),d=m(w);return((d==null?void 0:d.cost)||0)-((u==null?void 0:u.cost)||0)}).slice(0,5)),_=M(()=>y.value?Math.max(0,y.value.length-5):0),j=M(()=>{var d,D;if(!y.value||!a.value)return 0;const C=b.value.reduce((f,S)=>{const q=m(S);return f+((q==null?void 0:q.cost)||0)},0),w=c.value==="daily"?((d=a.value.dailyUsage)==null?void 0:d.cost)||0:((D=a.value.monthlyUsage)==null?void 0:D.cost)||0;if(w===0)return 0;const u=w-C;return Math.max(0,Math.round(u/w*100))}),x=C=>{var D,f;if(!a.value)return 0;const w=c.value==="daily"?((D=a.value.dailyUsage)==null?void 0:D.cost)||0:((f=a.value.monthlyUsage)==null?void 0:f.cost)||0;if(w===0)return 0;const u=m(C),d=((u==null?void 0:u.cost)||0)/w*100;return Math.round(d)},$=C=>["bg-blue-500","bg-green-500","bg-purple-500","bg-yellow-500","bg-pink-500"][C]||"bg-gray-400",U=C=>(typeof C!="number"&&(C=parseInt(C)||0),C===0?"0":C>=1e6?(C/1e6).toFixed(1)+"M":C>=1e3?(C/1e3).toFixed(1)+"K":C.toLocaleString());return(C,w)=>(l(),o("div",za,[t("h3",Ja,[w[0]||(w[0]=t("span",{class:"flex items-center"},[t("i",{class:"fas fa-chart-pie mr-2 text-sm text-orange-500 md:mr-3 md:text-base"}),k(" 使用占比 ")],-1)),t("span",Ga,"("+i(e(c)==="daily"?"今日":"本月")+")",1)]),e(a)&&e(y).length>0?(l(),o("div",Ya,[(l(!0),o(J,null,H(b.value,(u,d)=>{var D,f;return l(),o("div",{key:u.apiId,class:"relative"},[t("div",Ha,[t("span",Qa,i(u.name||`Key ${d+1}`),1),t("span",Xa,i(x(u))+"% ",1)]),t("div",Za,[t("div",{class:O(["h-2 rounded-full transition-all duration-300",$(d)]),style:lt({width:x(u)+"%"})},null,6)]),t("div",tr,[t("span",null,i(U(((D=m(u))==null?void 0:D.requests)||0))+"次",1),t("span",null,i(((f=m(u))==null?void 0:f.formattedCost)||"$0.00"),1)])])}),128)),_.value>0?(l(),o("div",er,[t("div",sr,[t("span",null,"其他 "+i(_.value)+" 个Keys",1),t("span",null,i(j.value)+"%",1)])])):L("",!0)])):e(n)?(l(),o("div",rr,w[2]||(w[2]=[t("i",{class:"fas fa-chart-pie mr-2"},null,-1),k(" 暂无数据 ",-1)]))):(l(),o("div",ar,w[1]||(w[1]=[t("div",{class:"text-center"},[t("i",{class:"fas fa-chart-pie mb-2 text-2xl"}),t("p",null,"使用占比仅在多Key查询时显示")],-1)])))]))}},ir=st(lr,[["__scopeId","data-v-39572a8e"]]),or={class:"card p-4 md:p-6"},nr={class:"mb-4 md:mb-6"},dr={class:"flex flex-col text-lg font-bold text-gray-900 dark:text-gray-100 sm:flex-row sm:items-center md:text-xl"},ur={class:"text-xs font-normal text-gray-600 dark:text-gray-400 sm:ml-2 md:text-sm"},cr={key:0,class:"py-6 text-center md:py-8"},mr={key:1,class:"space-y-3 md:space-y-4"},gr={class:"mb-2 flex items-start justify-between md:mb-3"},xr={class:"min-w-0 flex-1"},fr={class:"break-all text-base font-bold text-gray-900 dark:text-gray-100 md:text-lg"},yr={class:"text-xs text-gray-600 dark:text-gray-400 md:text-sm"},pr={class:"ml-3 flex-shrink-0 text-right"},vr={class:"text-base font-bold text-green-600 md:text-lg"},br={class:"grid grid-cols-2 gap-2 text-xs md:grid-cols-4 md:gap-3 md:text-sm"},kr={class:"rounded bg-gray-50 p-2 dark:bg-gray-700"},_r={class:"font-medium text-gray-900 dark:text-gray-100"},hr={class:"rounded bg-gray-50 p-2 dark:bg-gray-700"},wr={class:"font-medium text-gray-900 dark:text-gray-100"},$r={class:"rounded bg-gray-50 p-2 dark:bg-gray-700"},Cr={class:"font-medium text-gray-900 dark:text-gray-100"},Sr={class:"rounded bg-gray-50 p-2 dark:bg-gray-700"},Kr={class:"font-medium text-gray-900 dark:text-gray-100"},Ar={key:2,class:"py-6 text-center text-gray-500 dark:text-gray-400 md:py-8"},Lr={class:"text-sm md:text-base"},Tr={__name:"ModelUsageStats",setup(V){const v=rt(),{statsPeriod:a,modelStats:y,modelStatsLoading:c}=at(v),n=m=>(typeof m!="number"&&(m=parseInt(m)||0),m===0?"0":m>=1e6?(m/1e6).toFixed(1)+"M":m>=1e3?(m/1e3).toFixed(1)+"K":m.toLocaleString());return(m,b)=>(l(),o("div",or,[t("div",nr,[t("h3",dr,[b[0]||(b[0]=t("span",{class:"flex items-center"},[t("i",{class:"fas fa-robot mr-2 text-sm text-indigo-500 md:mr-3 md:text-base"}),k(" 模型使用统计 ")],-1)),t("span",ur,"("+i(e(a)==="daily"?"今日":"本月")+")",1)])]),e(c)?(l(),o("div",cr,b[1]||(b[1]=[t("i",{class:"fas fa-spinner loading-spinner mb-2 text-xl text-gray-600 dark:text-gray-400 md:text-2xl"},null,-1),t("p",{class:"text-sm text-gray-600 dark:text-gray-400 md:text-base"},"加载模型统计数据中...",-1)]))):e(y).length>0?(l(),o("div",mr,[(l(!0),o(J,null,H(e(y),(_,j)=>{var x;return l(),o("div",{key:j,class:"model-usage-item"},[t("div",gr,[t("div",xr,[t("h4",fr,i(_.model),1),t("p",yr,i(_.requests)+" 次请求 ",1)]),t("div",pr,[t("div",vr,i(((x=_.formatted)==null?void 0:x.total)||"$0.000000"),1),b[2]||(b[2]=t("div",{class:"text-xs text-gray-600 dark:text-gray-400 md:text-sm"},"总费用",-1))])]),t("div",br,[t("div",kr,[b[3]||(b[3]=t("div",{class:"text-gray-600 dark:text-gray-400"},"输入 Token",-1)),t("div",_r,i(n(_.inputTokens)),1)]),t("div",hr,[b[4]||(b[4]=t("div",{class:"text-gray-600 dark:text-gray-400"},"输出 Token",-1)),t("div",wr,i(n(_.outputTokens)),1)]),t("div",$r,[b[5]||(b[5]=t("div",{class:"text-gray-600 dark:text-gray-400"},"缓存创建",-1)),t("div",Cr,i(n(_.cacheCreateTokens)),1)]),t("div",Sr,[b[6]||(b[6]=t("div",{class:"text-gray-600 dark:text-gray-400"},"缓存读取",-1)),t("div",Kr,i(n(_.cacheReadTokens)),1)])])])}),128))])):(l(),o("div",Ar,[b[7]||(b[7]=t("i",{class:"fas fa-chart-pie mb-3 text-2xl md:text-3xl"},null,-1)),t("p",Lr," 暂无"+i(e(a)==="daily"?"今日":"本月")+"模型使用数据 ",1)]))]))}},Ir=st(Tr,[["__scopeId","data-v-b3b8dc5f"]]),Pr={class:"merge-card mb-8 rounded-3xl p-6 shadow-xl"},Mr={class:"mx-auto max-w-4xl"},Dr={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},qr=["disabled"],Or=["disabled"],jr={class:"mt-4 flex flex-wrap gap-3"},Ur=["disabled"],Rr={key:0,class:"fas fa-spinner loading-spinner"},Nr={key:1,class:"fas fa-link"},Er=["disabled"],Fr={key:0,class:"mt-4"},Vr={class:"rounded-xl border border-red-500/30 bg-red-500/10 p-3 text-sm text-red-700 dark:border-red-500/20 dark:bg-red-500/10 dark:text-red-200"},Wr={key:1,class:"mt-4"},Br={class:"rounded-xl border border-amber-400/40 bg-amber-50 p-3 text-sm text-amber-700 dark:border-amber-400/30 dark:bg-amber-900/20 dark:text-amber-200"},zr={class:"space-y-1"},Jr={key:2,class:"mt-4"},Gr={class:"rounded-xl border border-emerald-400/40 bg-emerald-50 p-3 text-sm text-emerald-700 dark:border-emerald-400/30 dark:bg-emerald-900/20 dark:text-emerald-200"},Yr={class:"mb-2 font-semibold"},Hr={class:"space-y-1"},Qr={__name:"KeyMergePanel",setup(V){const v=I(""),a=I(""),y=I(!1),c=I(""),n=I(null),m=I([]),b=f=>f.length>=10&&f.length<=512,_=M(()=>{const f=v.value.trim(),S=a.value.trim();return!b(f)||!b(S)?!1:f!==S}),j={concurrencyLimit:"并发限制",rateLimitWindow:"速率窗口",rateLimitRequests:"窗口请求次数",rateLimitCost:"窗口费用限制",tokenLimit:"窗口 Token 限制",claudeAccountId:"Claude 账号绑定",claudeConsoleAccountId:"Claude Console 账号绑定",geminiAccountId:"Gemini 账号绑定",openaiAccountId:"OpenAI 账号绑定",azureOpenaiAccountId:"Azure OpenAI 账号绑定",bedrockAccountId:"Bedrock 账号绑定",droidAccountId:"Droid 账号绑定",permissions:"权限范围",enableModelRestriction:"模型限制开关",restrictedModels:"模型白名单",enableClientRestriction:"客户端限制开关",allowedClients:"允许客户端",tags:"标签",expirationMode:"过期模式",activationUnit:"激活单位",activationDays:"激活有效期",dailyCostLimit:"每日费用额度",totalCostLimit:"总费用额度",weeklyOpusCostLimit:"Opus 周费用额度",expiresAt:"到期时间"},x=f=>j[f]||f,$=(f,S)=>S==="permissions"&&Array.isArray(f)&&f.length===0?"全部":Array.isArray(f)?f.length?f.join(", "):"无":f===""||f===null||f===void 0?"无":String(f),U=(f,S=!1)=>{const q=S?f.source:f.target;return $(q,f.field)},C=M(()=>{var T;if(!((T=n.value)!=null&&T.merged))return[];const f=n.value.merged,S=f.activationUnit==="hours"?"小时":"天";return[{field:"totalCostLimit",label:"总费用额度",value:f.totalCostLimit},{field:"dailyCostLimit",label:"每日费用额度",value:f.dailyCostLimit},{field:"weeklyOpusCostLimit",label:"Opus 周费用额度",value:f.weeklyOpusCostLimit},{field:"rateLimitCost",label:"窗口费用限制",value:f.rateLimitCost},{field:"rateLimitRequests",label:"窗口请求次数",value:f.rateLimitRequests},{field:"tokenLimit",label:"窗口 Token 限制",value:f.tokenLimit},{field:"activationDays",label:"激活有效期",value:f.activationDays&&f.activationDays>0?`${f.activationDays} ${S}`:f.activationDays,rawValue:f.activationDays},{field:"expiresAt",label:"到期时间",value:f.expiresAt}].filter(F=>{if(F.field==="expiresAt")return F.value!==void 0&&F.value!==null&&F.value!=="";const G=Number(F.rawValue??F.value);return Number.isFinite(G)&&G>0}).map(F=>({...F,value:$(F.value,F.field)}))}),w=M(()=>{var f;return((f=n.value)==null?void 0:f.action)==="replace"?"替换成功":"融合成功"}),u=M(()=>{var f;return((f=n.value)==null?void 0:f.action)==="replace"?"旧密钥已替换为新密钥配置，新密钥已禁用。":"旧密钥额度已合并，新密钥已禁用。"}),d=async()=>{var f,S,q;if(!_.value){c.value="请填写有效的旧密钥和新密钥";return}y.value=!0,c.value="",n.value=null,m.value=[];try{const T=await X.mergeKeys({targetApiKey:v.value.trim(),sourceApiKey:a.value.trim()});if(T!=null&&T.success)n.value=T.data;else throw new Error((T==null?void 0:T.message)||"密钥融合失败")}catch(T){c.value=((f=T==null?void 0:T.data)==null?void 0:f.message)||(T==null?void 0:T.message)||"密钥融合失败",m.value=((q=(S=T==null?void 0:T.data)==null?void 0:S.details)==null?void 0:q.mismatchFields)||[]}finally{y.value=!1}},D=()=>{v.value="",a.value="",c.value="",n.value=null,m.value=[]};return ut([v,a],()=>{c.value&&(c.value=""),m.value=[],n.value=null}),(f,S)=>(l(),o("div",Pr,[S[8]||(S[8]=t("div",{class:"mb-6"},[t("h2",{class:"mb-2 text-2xl font-bold text-gray-900 dark:text-gray-200"},[t("i",{class:"fas fa-link mr-3"}),k(" 密钥融合 ")]),t("p",{class:"text-base text-gray-600 dark:text-gray-400"}," 将新密钥额度合并到旧密钥中；若旧密钥已禁用，则直接用新密钥配置替换旧密钥。完成后新密钥会被禁用。 ")],-1)),t("div",Mr,[t("div",Dr,[t("div",null,[S[2]||(S[2]=t("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"},[t("i",{class:"fas fa-key mr-2"}),k(" 旧密钥（保留使用） ")],-1)),it(t("input",{"onUpdate:modelValue":S[0]||(S[0]=q=>v.value=q),class:"merge-input w-full",disabled:y.value,placeholder:"请输入旧密钥 (cr_...)",type:"password",autocomplete:"off"},null,8,qr),[[dt,v.value]])]),t("div",null,[S[3]||(S[3]=t("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"},[t("i",{class:"fas fa-key mr-2"}),k(" 新密钥（将被禁用） ")],-1)),it(t("input",{"onUpdate:modelValue":S[1]||(S[1]=q=>a.value=q),class:"merge-input w-full",disabled:y.value,placeholder:"请输入新密钥 (cr_...)",type:"password",autocomplete:"off"},null,8,Or),[[dt,a.value]])])]),t("div",jr,[t("button",{class:"merge-button flex items-center justify-center gap-2",disabled:y.value||!_.value,onClick:d},[y.value?(l(),o("i",Rr)):(l(),o("i",Nr)),k(" "+i(y.value?"融合中...":"开始融合"),1)],8,Ur),t("button",{class:"merge-clear",disabled:y.value,onClick:D}," 清空输入 ",8,Er)]),S[6]||(S[6]=t("div",{class:"merge-notice mt-4"},[t("i",{class:"fas fa-shield-alt mr-2"}),k(" 密钥融合仅在两把密钥设置一致且新密钥未使用时可执行（天卡有效期天数、按量总量额度允许不一致）；旧密钥已禁用时将直接替换配置并保留旧密钥。 ")],-1)),c.value?(l(),o("div",Fr,[t("div",Vr,[S[4]||(S[4]=t("i",{class:"fas fa-exclamation-triangle mr-2"},null,-1)),k(" "+i(c.value),1)])])):L("",!0),m.value.length?(l(),o("div",Wr,[t("div",Br,[S[5]||(S[5]=t("div",{class:"mb-2 font-semibold"},"以下设置不一致：",-1)),t("ul",zr,[(l(!0),o(J,null,H(m.value,q=>(l(),o("li",{key:q.field},i(x(q.field))+"：旧= "+i(U(q))+"，新= "+i(U(q,!0)),1))),128))])])])):L("",!0),n.value?(l(),o("div",Jr,[t("div",Gr,[t("div",Yr,i(w.value),1),t("div",Hr,[t("div",null,i(u.value),1),(l(!0),o(J,null,H(C.value,q=>(l(),o("div",{key:q.field},i(q.label)+"："+i(q.value),1))),128))])])])):L("",!0),S[7]||(S[7]=t("div",{class:"merge-notice mt-3 text-xs text-gray-500 dark:text-gray-400"},[t("i",{class:"fas fa-lock mr-2"}),k(" 密钥仅用于本次融合操作，不会被存储。 ")],-1))])]))}},Xr=st(Qr,[["__scopeId","data-v-966fb730"]]),Zr={key:0,class:"fixed inset-0 z-[1050] flex items-center justify-center bg-gray-900/40 backdrop-blur-sm"},tl={class:"relative z-10 mx-3 flex w-full max-w-lg flex-col overflow-hidden rounded-2xl border border-gray-200/70 bg-white/95 shadow-2xl ring-1 ring-black/5 transition-all dark:border-gray-700/60 dark:bg-gray-900/95 dark:ring-white/10 sm:mx-4"},el={class:"flex items-center justify-between border-b border-gray-100 bg-white/80 px-5 py-4 backdrop-blur dark:border-gray-800 dark:bg-gray-900/80"},sl={class:"flex items-center gap-3"},al={class:"text-xs text-gray-500 dark:text-gray-400"},rl=["disabled"],ll={class:"max-h-[70vh] overflow-y-auto px-5 py-4"},il={class:"mb-4"},ol={class:"relative"},nl=["value"],dl={class:"mb-4 grid grid-cols-1 gap-3 sm:grid-cols-2"},ul=["disabled"],cl=["value"],ml=["disabled"],gl=["value"],xl={class:"mb-4 space-y-2"},fl={class:"flex items-center justify-between text-sm"},yl={class:"inline-flex items-center gap-1.5 rounded-full bg-blue-100 px-2.5 py-0.5 text-xs font-medium text-blue-700 dark:bg-blue-500/20 dark:text-blue-300"},pl={class:"flex items-center justify-between text-sm"},vl={class:"font-medium text-gray-700 dark:text-gray-300"},bl={class:"flex items-center justify-between text-sm"},kl={class:"font-medium text-gray-700 dark:text-gray-300"},_l={class:"flex items-center gap-3"},hl={class:"text-xs text-gray-500 dark:text-gray-400"},wl={key:0,class:"mb-4 overflow-hidden rounded-xl border border-gray-200 bg-gray-50 dark:border-gray-700 dark:bg-gray-800/50"},$l={class:"flex items-center justify-between border-b border-gray-200 bg-gray-100 px-3 py-2 dark:border-gray-700 dark:bg-gray-800"},Cl={key:0,class:"text-xs text-gray-500 dark:text-gray-500"},Sl={class:"max-h-40 overflow-y-auto p-3"},Kl={key:0,class:"whitespace-pre-wrap text-sm text-gray-700 dark:text-gray-300"},Al={key:0,class:"inline-block h-4 w-1 animate-pulse bg-blue-500"},Ll={key:1,class:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400"},Tl={key:2,class:"text-sm text-red-600 dark:text-red-400"},Il={key:1,class:"mb-4 flex items-center justify-center gap-2 text-xs text-gray-500 dark:text-gray-400"},Pl={class:"flex items-center justify-end gap-3 border-t border-gray-100 bg-gray-50/80 px-5 py-3 dark:border-gray-800 dark:bg-gray-900/50"},Ml=["disabled"],Dl=["disabled"],ql={__name:"ApiKeyTestModal",props:{show:{type:Boolean,default:!1},apiKeyValue:{type:String,default:""},apiKeyName:{type:String,default:""}},emits:["close"],setup(V,{emit:v}){const a=V,y=v,c={claude:{label:"Claude",endpoint:"/api/v1/messages",client:"Claude Code",defaultModel:"claude-sonnet-4-5-20250929",models:["claude-sonnet-4-5-20250929","claude-opus-4-1-20250805"]},gemini:{label:"Gemini",endpoint:"/gemini/v1beta/models/{model}:generateContent",client:"Gemini CLI",defaultModel:"gemini-2.5-pro",models:["gemini-2.5-pro","gemini-2.5-flash"]},codex:{label:"Codex",endpoint:"/openai/v1/responses",client:"Codex CLI",defaultModel:"gpt-5.2-codex",models:["gpt-5.2-codex","gpt-5","gpt-5-mini"]}},n=I("idle"),m=I(""),b=I(""),_=I(0),j=I(null),x=I(null),$=I("claude"),U=I(c.claude.defaultModel),C=M(()=>a.apiKeyName||"当前 API Key"),w=M(()=>{const R=a.apiKeyValue;return R?R.length<=10?"****":R.substring(0,6)+"****"+R.substring(R.length-4):""}),u=M(()=>c[$.value]||c.claude),d=M(()=>Object.entries(c).map(([R,s])=>({value:R,label:s.label}))),D=M(()=>u.value.models),f=M(()=>u.value.endpoint),S=M(()=>u.value.client),q=M(()=>{switch(n.value){case"idle":return"准备就绪";case"testing":return"正在测试...";case"success":return"测试成功";case"error":return"测试失败";default:return"未知状态"}}),T=M(()=>{switch(n.value){case"idle":return"点击下方按钮开始测试 API Key 连通性";case"testing":return`正在通过 ${f.value} 发送测试请求`;case"success":return"API Key 可以正常访问服务";case"error":return b.value||"无法通过 API Key 访问服务";default:return""}}),F=M(()=>{switch(n.value){case"idle":return"border-gray-200 bg-gray-50 dark:border-gray-700 dark:bg-gray-800/50";case"testing":return"border-blue-200 bg-blue-50 dark:border-blue-500/30 dark:bg-blue-900/20";case"success":return"border-green-200 bg-green-50 dark:border-green-500/30 dark:bg-green-900/20";case"error":return"border-red-200 bg-red-50 dark:border-red-500/30 dark:bg-red-900/20";default:return"border-gray-200 bg-gray-50 dark:border-gray-700 dark:bg-gray-800/50"}}),G=M(()=>{switch(n.value){case"idle":return"bg-gray-200 dark:bg-gray-700";case"testing":return"bg-blue-100 dark:bg-blue-500/30";case"success":return"bg-green-100 dark:bg-green-500/30";case"error":return"bg-red-100 dark:bg-red-500/30";default:return"bg-gray-200 dark:bg-gray-700"}}),Z=M(()=>{switch(n.value){case"idle":return"fa-hourglass-start";case"testing":return"fa-spinner fa-spin";case"success":return"fa-check-circle";case"error":return"fa-exclamation-circle";default:return"fa-question-circle"}}),W=M(()=>{switch(n.value){case"idle":return"text-gray-500 dark:text-gray-400";case"testing":return"text-blue-500 dark:text-blue-400";case"success":return"text-green-500 dark:text-green-400";case"error":return"text-red-500 dark:text-red-400";default:return"text-gray-500 dark:text-gray-400"}}),K=M(()=>{switch(n.value){case"idle":return"text-gray-700 dark:text-gray-300";case"testing":return"text-blue-700 dark:text-blue-300";case"success":return"text-green-700 dark:text-green-300";case"error":return"text-red-700 dark:text-red-300";default:return"text-gray-700 dark:text-gray-300"}});async function tt(){if(!a.apiKeyValue)return;n.value="testing",m.value="",b.value="",_.value=0,j.value=Date.now(),x.value&&x.value.abort(),x.value=new AbortController;const R=`${$t}/apiStats/api-key/test`;try{const s=await fetch(R,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apiKey:a.apiKeyValue,provider:$.value,model:U.value}),signal:x.value.signal});if(!s.ok){const N=await s.json().catch(()=>({}));throw new Error(N.message||N.error||`HTTP ${s.status}`)}const r=s.body.getReader(),p=new TextDecoder;let A=!1;for(;!A;){const{done:N,value:g}=await r.read();if(N){A=!0;continue}const P=p.decode(g).split(`
`);for(const B of P)if(B.startsWith("data: "))try{const E=JSON.parse(B.substring(6));et(E)}catch{}}}catch(s){if(s.name==="AbortError")return;n.value="error",b.value=s.message||"连接失败",_.value=Date.now()-j.value}}ut($,R=>{const s=c[R]||c.claude;s.models.includes(U.value)||(U.value=s.defaultModel)},{immediate:!0});function et(R){switch(R.type){case"test_start":break;case"content":m.value+=R.text;break;case"message_stop":break;case"test_complete":_.value=Date.now()-j.value,R.success?n.value="success":(n.value="error",b.value=R.error||"测试失败");break;case"error":n.value="error",b.value=R.error||"未知错误",_.value=Date.now()-j.value;break}}function z(){n.value!=="testing"&&(x.value&&(x.value.abort(),x.value=null),n.value="idle",m.value="",b.value="",_.value=0,y("close"))}return ut(()=>a.show,R=>{R&&(n.value="idle",m.value="",b.value="",_.value=0,$.value="claude",U.value=c.claude.defaultModel)}),pt(()=>{x.value&&x.value.abort()}),(R,s)=>(l(),nt(kt,{to:"body"},[V.show?(l(),o("div",Zr,[t("div",{class:"absolute inset-0",onClick:z}),t("div",tl,[t("div",el,[t("div",sl,[t("div",{class:O(["flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-xl text-white shadow-lg",n.value==="success"?"bg-gradient-to-br from-green-500 to-emerald-500":n.value==="error"?"bg-gradient-to-br from-red-500 to-pink-500":"bg-gradient-to-br from-blue-500 to-indigo-500"])},[t("i",{class:O(["fas",n.value==="idle"?"fa-vial":n.value==="testing"?"fa-spinner fa-spin":n.value==="success"?"fa-check":"fa-times"])},null,2)],2),t("div",null,[s[2]||(s[2]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-gray-100"}," API Key 端点测试 ",-1)),t("p",al,i(C.value),1)])]),t("button",{class:"flex h-9 w-9 items-center justify-center rounded-full bg-gray-100 text-gray-500 transition hover:bg-gray-200 hover:text-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-gray-200",disabled:n.value==="testing",onClick:z},s[3]||(s[3]=[t("i",{class:"fas fa-times text-sm"},null,-1)]),8,rl)]),t("div",ll,[t("div",il,[s[5]||(s[5]=t("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," API Key ",-1)),t("div",ol,[t("input",{class:"w-full rounded-lg border border-gray-200 bg-gray-50 px-3 py-2 pr-10 text-sm text-gray-700 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",readonly:"",type:"text",value:w.value},null,8,nl),s[4]||(s[4]=t("div",{class:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400"},[t("i",{class:"fas fa-lock text-xs"})],-1))]),s[6]||(s[6]=t("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," 测试将使用此 API Key 调用当前服务的 /api 端点 ",-1))]),t("div",dl,[t("div",null,[s[7]||(s[7]=t("label",{class:"mb-1 block text-xs font-medium text-gray-500 dark:text-gray-400"}," 测试平台 ",-1)),it(t("select",{"onUpdate:modelValue":s[0]||(s[0]=r=>$.value=r),class:"w-full rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm text-gray-700 focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",disabled:n.value==="testing"},[(l(!0),o(J,null,H(d.value,r=>(l(),o("option",{key:r.value,value:r.value},i(r.label),9,cl))),128))],8,ul),[[ft,$.value]])]),t("div",null,[s[8]||(s[8]=t("label",{class:"mb-1 block text-xs font-medium text-gray-500 dark:text-gray-400"}," 测试模型 ",-1)),it(t("select",{"onUpdate:modelValue":s[1]||(s[1]=r=>U.value=r),class:"w-full rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm text-gray-700 focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",disabled:n.value==="testing"},[(l(!0),o(J,null,H(D.value,r=>(l(),o("option",{key:r,value:r},i(r),9,gl))),128))],8,ml),[[ft,U.value]])])]),t("div",xl,[t("div",fl,[s[10]||(s[10]=t("span",{class:"text-gray-500 dark:text-gray-400"},"测试端点",-1)),t("span",yl,[s[9]||(s[9]=t("i",{class:"fas fa-link"},null,-1)),k(" "+i(f.value),1)])]),t("div",pl,[s[11]||(s[11]=t("span",{class:"text-gray-500 dark:text-gray-400"},"测试模型",-1)),t("span",vl,i(U.value),1)]),t("div",bl,[s[12]||(s[12]=t("span",{class:"text-gray-500 dark:text-gray-400"},"模拟客户端",-1)),t("span",kl,i(S.value),1)])]),t("div",{class:O(["mb-4 rounded-xl border p-4 transition-all duration-300",F.value])},[t("div",_l,[t("div",{class:O(["flex h-8 w-8 items-center justify-center rounded-lg",G.value])},[t("i",{class:O(["fas text-sm",Z.value,W.value])},null,2)],2),t("div",null,[t("p",{class:O(["font-medium",K.value])},i(q.value),3),t("p",hl,i(T.value),1)])])],2),n.value!=="idle"?(l(),o("div",wl,[t("div",$l,[s[13]||(s[13]=t("span",{class:"text-xs font-medium text-gray-600 dark:text-gray-400"},"AI 响应",-1)),m.value?(l(),o("span",Cl,i(m.value.length)+" 字符 ",1)):L("",!0)]),t("div",Sl,[m.value?(l(),o("p",Kl,[k(i(m.value)+" ",1),n.value==="testing"?(l(),o("span",Al)):L("",!0)])):n.value==="testing"?(l(),o("p",Ll,s[14]||(s[14]=[t("i",{class:"fas fa-circle-notch fa-spin"},null,-1),k(" 等待响应中... ",-1)]))):n.value==="error"&&b.value?(l(),o("p",Tl,i(b.value),1)):L("",!0)])])):L("",!0),_.value>0?(l(),o("div",Il,[s[15]||(s[15]=t("i",{class:"fas fa-clock"},null,-1)),t("span",null,"耗时 "+i((_.value/1e3).toFixed(2))+" 秒",1)])):L("",!0)]),t("div",Pl,[t("button",{class:"rounded-lg border border-gray-200 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm transition hover:bg-gray-50 hover:shadow dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700",disabled:n.value==="testing",onClick:z}," 关闭 ",8,Ml),t("button",{class:O(["flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium shadow-sm transition",n.value==="testing"||!V.apiKeyValue?"cursor-not-allowed bg-gray-200 text-gray-400 dark:bg-gray-700 dark:text-gray-500":"bg-gradient-to-r from-blue-500 to-indigo-500 text-white hover:from-blue-600 hover:to-indigo-600 hover:shadow-md"]),disabled:n.value==="testing"||!V.apiKeyValue,onClick:tt},[t("i",{class:O(["fas",n.value==="testing"?"fa-spinner fa-spin":"fa-play"])},null,2),k(" "+i(n.value==="testing"?"测试中...":n.value==="idle"?"开始测试":"重新测试"),1)],10,Dl)])])])):L("",!0)]))}},Ol={class:"glass-strong mb-6 rounded-3xl p-4 shadow-xl md:mb-8 md:p-6"},jl={class:"flex flex-col items-center justify-between gap-4 md:flex-row"},Ul={class:"flex items-center gap-2 md:gap-4"},Rl={class:"flex items-center"},Nl={key:0,class:"h-8 w-px bg-gradient-to-b from-transparent via-gray-300 to-transparent opacity-50 dark:via-gray-600"},El={class:"mb-6 md:mb-8"},Fl={class:"flex justify-center"},Vl={class:"inline-flex w-full max-w-lg rounded-full border border-white/20 bg-white/10 p-1 shadow-lg backdrop-blur-xl md:w-auto"},Wl={key:0,class:"tab-content"},Bl={key:0,class:"mb-6 md:mb-8"},zl={class:"rounded-xl border border-red-500/30 bg-red-500/20 p-3 text-sm text-red-800 backdrop-blur-sm dark:border-red-500/20 dark:bg-red-500/10 dark:text-red-200 md:p-4 md:text-base"},Jl={key:1,class:"fade-in"},Gl={class:"glass-strong rounded-3xl p-4 shadow-xl md:p-6"},Yl={class:"mb-4 border-b border-gray-200 pb-4 dark:border-gray-700 md:mb-6 md:pb-6"},Hl={class:"flex flex-col items-start justify-between gap-3 md:flex-row md:items-center md:gap-4"},Ql={class:"flex w-full items-center gap-2 md:w-auto"},Xl=["disabled"],Zl=["disabled"],ti=["disabled"],ei={class:"mb-6 mt-6 grid grid-cols-1 gap-4 md:mb-8 md:mt-8 md:gap-6 xl:grid-cols-2 xl:items-stretch"},si={key:1,class:"tab-content"},ai={class:"glass-strong rounded-3xl shadow-xl"},ri={key:2,class:"tab-content"},li={__name:"ApiStatsView",setup(V){const v=ht(),a=rt(),y=Ct(),c=I("stats"),n=M(()=>y.isDarkMode),{apiKey:m,apiId:b,loading:_,modelStatsLoading:j,oemLoading:x,error:$,statsPeriod:U,statsData:C,oemSettings:w,multiKeyMode:u}=at(a),{queryStats:d,switchPeriod:D,loadStatsWithApiId:f,loadOemSettings:S,reset:q}=a,T=I(!1),F=()=>{T.value=!0},G=()=>{T.value=!1},Z=W=>{(W.ctrlKey||W.metaKey)&&W.key==="Enter"&&(!_.value&&m.value.trim()&&d(),W.preventDefault()),W.key==="Escape"&&q()};return _t(()=>{y.initTheme(),S();const W=v.query.apiId,K=v.query.apiKey;W&&W.match(/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/i)?(b.value=W,f()):K&&K.length>10&&(m.value=K),document.addEventListener("keydown",Z)}),pt(()=>{document.removeEventListener("keydown",Z)}),ut(m,W=>{W||a.clearData()}),(W,K)=>{var et;const tt=wt("router-link");return l(),o("div",{class:O(["min-h-screen p-4 md:p-6",n.value?"gradient-bg-dark":"gradient-bg"])},[t("div",Ol,[t("div",jl,[Q(St,{loading:e(x),"logo-src":e(w).siteIconData||e(w).siteIcon,subtitle:c.value==="stats"?"API Key 使用统计":c.value==="merge"?"密钥融合":"使用教程",title:e(w).siteName},null,8,["loading","logo-src","subtitle","title"]),t("div",Ul,[t("div",Rl,[Q(Kt,{mode:"dropdown"})]),e(w).ldapEnabled||e(w).showAdminButton!==!1?(l(),o("div",Nl)):L("",!0),e(w).ldapEnabled?(l(),nt(tt,{key:1,class:"user-login-button flex items-center gap-2 rounded-2xl px-4 py-2 text-white transition-all duration-300 md:px-5 md:py-2.5",to:"/user-login"},{default:yt(()=>K[5]||(K[5]=[t("i",{class:"fas fa-user text-sm md:text-base"},null,-1),t("span",{class:"text-xs font-semibold tracking-wide md:text-sm"},"用户登录",-1)])),_:1,__:[5]})):L("",!0),e(w).showAdminButton!==!1?(l(),nt(tt,{key:2,class:"admin-button-refined flex items-center gap-2 rounded-2xl px-4 py-2 transition-all duration-300 md:px-5 md:py-2.5",to:"/dashboard"},{default:yt(()=>K[6]||(K[6]=[t("i",{class:"fas fa-shield-alt text-sm md:text-base"},null,-1),t("span",{class:"text-xs font-semibold tracking-wide md:text-sm"},"管理后台",-1)])),_:1,__:[6]})):L("",!0)])])]),t("div",El,[t("div",Fl,[t("div",Vl,[t("button",{class:O(["tab-pill-button",c.value==="stats"?"active":""]),onClick:K[0]||(K[0]=z=>c.value="stats")},K[7]||(K[7]=[t("i",{class:"fas fa-chart-line mr-1 md:mr-2"},null,-1),t("span",{class:"text-sm md:text-base"},"统计查询",-1)]),2),t("button",{class:O(["tab-pill-button",c.value==="merge"?"active":""]),onClick:K[1]||(K[1]=z=>c.value="merge")},K[8]||(K[8]=[t("i",{class:"fas fa-link mr-1 md:mr-2"},null,-1),t("span",{class:"text-sm md:text-base"},"密钥融合",-1)]),2),t("button",{class:O(["tab-pill-button",c.value==="tutorial"?"active":""]),onClick:K[2]||(K[2]=z=>c.value="tutorial")},K[9]||(K[9]=[t("i",{class:"fas fa-graduation-cap mr-1 md:mr-2"},null,-1),t("span",{class:"text-sm md:text-base"},"使用教程",-1)]),2)])])]),c.value==="stats"?(l(),o("div",Wl,[Q(Qt),e($)?(l(),o("div",Bl,[t("div",zl,[K[10]||(K[10]=t("i",{class:"fas fa-exclamation-triangle mr-2"},null,-1)),k(" "+i(e($)),1)])])):L("",!0),e(C)?(l(),o("div",Jl,[t("div",Gl,[t("div",Yl,[t("div",Hl,[K[14]||(K[14]=t("div",{class:"flex items-center gap-2 md:gap-3"},[t("i",{class:"fas fa-clock text-base text-blue-500 md:text-lg"}),t("span",{class:"text-base font-medium text-gray-700 dark:text-gray-200 md:text-lg"},"统计时间范围")],-1)),t("div",Ql,[t("button",{class:O(["flex flex-1 items-center justify-center gap-1 px-4 py-2 text-xs font-medium md:flex-none md:gap-2 md:px-6 md:text-sm",["period-btn",{active:e(U)==="daily"}]]),disabled:e(_)||e(j),onClick:K[3]||(K[3]=z=>e(D)("daily"))},K[11]||(K[11]=[t("i",{class:"fas fa-calendar-day text-xs md:text-sm"},null,-1),k(" 今日 ",-1)]),10,Xl),t("button",{class:O(["flex flex-1 items-center justify-center gap-1 px-4 py-2 text-xs font-medium md:flex-none md:gap-2 md:px-6 md:text-sm",["period-btn",{active:e(U)==="monthly"}]]),disabled:e(_)||e(j),onClick:K[4]||(K[4]=z=>e(D)("monthly"))},K[12]||(K[12]=[t("i",{class:"fas fa-calendar-alt text-xs md:text-sm"},null,-1),k(" 本月 ",-1)]),10,Zl),e(u)?L("",!0):(l(),o("button",{key:0,class:"test-btn flex items-center justify-center gap-1 px-4 py-2 text-xs font-medium md:gap-2 md:px-6 md:text-sm",disabled:e(_),onClick:F},K[13]||(K[13]=[t("i",{class:"fas fa-vial text-xs md:text-sm"},null,-1),k(" 测试 ",-1)]),8,ti))])])]),Q(ys),t("div",ei,[Q(Ds,{class:"h-full"}),e(u)?(l(),nt(ir,{key:0,class:"h-full"})):(l(),nt(Ba,{key:1,class:"h-full"}))]),Q(Ir)])])):L("",!0)])):L("",!0),c.value==="tutorial"?(l(),o("div",si,[t("div",ai,[Q(Tt)])])):L("",!0),c.value==="merge"?(l(),o("div",ri,[Q(Xr)])):L("",!0),Q(ql,{"api-key-name":((et=e(C))==null?void 0:et.name)||"","api-key-value":e(m),show:T.value,onClose:G},null,8,["api-key-name","api-key-value","show"])],2)}}},xi=st(li,[["__scopeId","data-v-0e73c45a"]]);export{xi as default};
